<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì„ ìˆ˜ ê¸°ë¡ ì¡°íšŒ ë° ë¶„ì•¼ë³„ ìˆœìœ„</title>
  <style>
/* =======================
   í…Œë§ˆ ë³€ìˆ˜ (ë¼ì´íŠ¸/ë‹¤í¬)
   ======================= */
:root{
  --bg:#f9faff; --text:#333; --card:#ffffff; --border:#dddddd; --brand:#1a73e8;
  --thead:#e8f0fe; --theadText:#1a73e8; --link:#1a73e8;
  /* MVP ë°°ë„ˆ(ë¼ì´íŠ¸) */
  --mvp-bg:#1b3764; --mvp-star:#17438a; --mvp-shadow:#0f2a55;
  --mvp-text:#8a160e; --mvp-glow1:#d64a4a; --mvp-glow2:#bf1e1e;
  --mvp-badge:#8a160e; --mvp-badge-glow:#d64a4a; --mvp-name:#8a160e;
  --mvp-name-glow:#bf1e1e; --mvp-info:#eeeeee;
}
[data-theme="dark"]{
  --bg:#0f172a; --text:#e5e7eb; --card:#0b1220; --border:#22314d; --brand:#86b7ff;
  --thead:#13213a; --theadText:#cfe2ff; --link:#9ec5fe;
  /* MVP ë°°ë„ˆ(ë‹¤í¬) */
  --mvp-bg:#0c1a33; --mvp-star:#0f285e; --mvp-shadow:#05152e;
  --mvp-text:#ffb4a2; --mvp-glow1:#ff7070; --mvp-glow2:#ff4d4d;
  --mvp-badge:#b23a3a; --mvp-badge-glow:#ff7070; --mvp-name:#ffd1c7;
  --mvp-name-glow:#ff8e7a; --mvp-info:#e5e7eb;
}

/* ============ ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ============ */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  max-width: 900px; margin: 40px auto; padding: 20px 30px;
  background-color: var(--bg); color: var(--text); overflow-x: auto;
}
h1 { font-weight: 700; font-size: 2rem; margin-bottom: 10px; color: var(--brand); text-align: center; }

/* ë‹¤í¬ ëª¨ë“œ í† ê¸€ ë²„íŠ¼ */
#themeToggle{
  float:right; margin-top:-4px; margin-bottom:10px; padding:6px 10px; border-radius:6px;
  border:1px solid var(--border); background:var(--card); color:var(--text); cursor:pointer;
}

button#goToInputBtn {
  background-color: var(--brand); color: white; font-weight: 600; padding: 10px 18px;
  border: none; border-radius: 6px; cursor: pointer; transition: background-color 0.3s ease;
  margin-bottom: 20px; display: inline-block;
}
button#goToInputBtn:hover { filter: brightness(0.9); }

#searchInput {
  width: 100%; padding: 10px; margin-bottom: 20px; border-radius: 6px;
  border: 1.5px solid var(--border); background: var(--card); color: var(--text); font-size: 1rem;
}
.container { display: flex; gap: 30px; min-height: 350px; flex-wrap: wrap; }
nav.menu {
  width: 180px; background-color: var(--card); border: 1px solid var(--border); border-radius: 8px;
  box-shadow: 0 2px 8px rgb(26 115 232 / 0.15); overflow-y: auto; padding: 10px 0; flex-shrink: 0;
}
nav.menu h2 { font-weight: 700; font-size: 1.2rem; color: var(--brand); padding: 8px 16px; border-bottom: 1px solid var(--border); margin-bottom: 10px; }
nav.menu ul { list-style: none; padding-left: 0; margin: 0; }
nav.menu li {
  padding: 10px 16px; cursor: pointer; transition: background-color 0.3s ease, color 0.3s ease;
  font-weight: 600; font-size: 0.95rem; border-radius: 4px; margin: 2px 8px;
}
nav.menu li:hover { background-color: rgba(134,183,255,0.2); color: var(--brand); }
nav.menu li.active { background-color: var(--brand); color: white; }

section.content {
  flex: 1 1 600px; background-color: var(--card); border-radius: 8px; border: 1px solid var(--border);
  box-shadow: 0 2px 8px rgb(26 115 232 / 0.15); padding: 20px; overflow-x: auto; min-width: 300px;
}

table { width: 100%; border-collapse: collapse; margin-top: 10px; min-width: 500px; }
th, td {
  border: 1px solid var(--border); padding: 10px 12px; text-align: center; font-size: 0.95rem;
  white-space: nowrap; background: transparent; color: var(--text);
}
th { background-color: var(--thead); color: var(--theadText); font-weight: 700; user-select: none; }
p.no-data { font-size: 1.1rem; color: #8892a6; text-align: center; margin-top: 40px; }
/* ì„ ìˆ˜ ì´ë¦„ ë§í¬ ìŠ¤íƒ€ì¼ */
td.player-name { color: var(--link); cursor: pointer; text-decoration: underline; }

/* MVP ë°°ë„ˆ */
#recentMvpSection {
  position: relative; width: 600px; height: 140px; margin: 0 auto 20px auto;
  background-color: var(--mvp-bg); border-radius: 15px;
  box-shadow: 0 0 10px var(--mvp-shadow), inset 0 0 20px #2e5ba6;
  display: flex; align-items: center; padding: 0 30px 0 90px; overflow: hidden; user-select: none;
}
#recentMvpSection::before {
  content: "â˜…"; position: absolute; left: 30px; font-size: 6rem; color: var(--mvp-star);
  opacity: 0.3; filter: drop-shadow(0 0 4px var(--mvp-shadow)); animation: starGlow 3s infinite ease-in-out;
  z-index: 1; user-select: none;
}
@keyframes starGlow { 0%,100%{opacity:.3;filter:drop-shadow(0 0 4px var(--mvp-shadow));} 50%{opacity:1;filter:drop-shadow(0 0 15px #4aa0ff);} }
#mvpText {
  font-weight: 900; font-size: 4.5rem; color: var(--mvp-text);
  text-shadow: 0 0 12px var(--mvp-glow1), 0 0 25px var(--mvp-glow1), 0 0 30px var(--mvp-text), 0 0 40px var(--mvp-text);
  margin-right: 20px; animation: mvpPulse 2.5s ease-in-out infinite alternate; z-index: 10; user-select: none; white-space: nowrap;
}
@keyframes mvpPulse{
  0%{transform:scale(1); color:var(--mvp-text);}
  50%{transform:scale(1.1) rotate(-5deg); color:var(--mvp-glow2);}
  100%{transform:scale(1); color:var(--mvp-text);}
}
#sportsBadge{ font-size:1.1rem; font-weight:600; background:var(--mvp-badge); color:#fff; border-radius:12px; padding:3px 10px; margin-left:8px;
  box-shadow:0 0 10px var(--mvp-badge-glow); animation:sportsGlow 2.5s ease-in-out infinite alternate; }
@keyframes sportsGlow{0%{box-shadow:0 0 10px var(--mvp-badge-glow);}50%{box-shadow:0 0 20px var(--mvp-badge-glow);}100%{box-shadow:0 0 10px var(--mvp-badge-glow);}}
#playerName{ font-weight:900; font-size:3.3rem; color:var(--mvp-name); margin-left:20px;
  text-shadow:0 0 10px var(--mvp-glow1), 0 0 20px var(--mvp-name-glow); white-space:nowrap; }
#playerInfo{ font-size:1.2rem; font-weight:600; color:var(--mvp-info); margin-left:25px; text-shadow:0 0 10px #222; white-space:nowrap; }

/* ì„¹ì…˜ ì¹´ë“œ */
#mvpRankingSection, #teamStatsSection {
  background: var(--card); border: 1px solid var(--border); padding: 15px 20px; border-radius: 8px; margin-bottom: 30px;
  box-shadow: 0 2px 8px rgb(26 115 232 / 0.15);
}
[data-theme="dark"] #teamStatsSection tbody tr:nth-child(odd),
[data-theme="dark"] #mvpRankingSection tbody tr:nth-child(odd){ background: rgba(255,255,255,0.03); }
#mvpRankingSection h3, #teamStatsSection h3 { color: var(--brand); margin-bottom: 15px; font-weight: 700; }

/* ìˆœìœ„ ë©”ë‹¬ */
.rank-cell{ font-weight:700; }
.rank-medal{ font-size:1.25rem; margin-right:6px; vertical-align:-2px; }

/* í‘¸í„° */
footer{
  margin-top:26px; text-align:center; color:#6b7280; font-size:.92rem;
}
  </style>
</head>
<body>

  <h1>ì„ ìˆ˜ ê¸°ë¡ ì¡°íšŒ ë° ë¶„ì•¼ë³„ ìˆœìœ„</h1>
  <button id="themeToggle" aria-label="Toggle Dark Mode">ğŸŒ™ ë‹¤í¬ ëª¨ë“œ</button>

  <div id="recentMvpSection">
    <div id="mvpText">
      MVP <span id="sportsBadge">SPORTS</span>
    </div>
    <div id="playerName">ê¹€ì¤€ìš°</div>
    <div id="playerInfo">(Leaders / SP)</div>
  </div>

  <button id="goToInputBtn">ê¸°ë¡ ì…ë ¥ í˜ì´ì§€ë¡œ ì´ë™</button>

  <input type="text" id="searchInput" placeholder="ì„ ìˆ˜ ì´ë¦„ ê²€ìƒ‰" autocomplete="off" />

  <div class="container">
    <nav class="menu">
      <h2>íƒ€ì ë¶„ì•¼</h2>
      <ul id="hitterMenu">
        <li data-stat="íƒ€ìœ¨">íƒ€ìœ¨</li>
        <li data-stat="í™ˆëŸ°">í™ˆëŸ°</li>
        <li data-stat="ì¶œë£¨ìœ¨">ì¶œë£¨ìœ¨</li>
        <li data-stat="OPS">OPS</li>
        <li data-stat="íƒ€ì ">íƒ€ì </li>
        <li data-stat="WAR">WAR</li>
      </ul>
      <h2>íˆ¬ìˆ˜ ë¶„ì•¼</h2>
      <ul id="pitcherMenu">
        <li data-stat="ìŠ¹ë¦¬">ìŠ¹ë¦¬</li>
        <li data-stat="ì„¸ì´ë¸Œ">ì„¸ì´ë¸Œ</li>
        <li data-stat="í™€ë“œ">í™€ë“œ</li>
        <li data-stat="ì‚¼ì§„">ì‚¼ì§„</li>
        <li data-stat="ERA">ERA</li>
        <li data-stat="WHIP">WHIP</li>
      </ul>
    </nav>

    <section class="content" id="rankingContent">
      <p class="no-data">ë¶„ì•¼ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
    </section>
  </div>

  <div id="mvpRankingSection" style="display:none;">
    <h3>MVP ìˆœìœ„</h3>
    <table id="mvpRankingTable">
      <thead>
        <tr>
          <th>ìˆœìœ„</th>
          <th>ì„ ìˆ˜ëª…</th>
          <th>íŒ€</th>
          <th>MVP íšŸìˆ˜</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="teamStatsSection" style="display:none;">
    <h3>íŒ€ë³„ ì£¼ìš” í†µê³„</h3>
    <table id="teamStatsTable">
      <thead>
        <tr>
          <th>íŒ€ëª…</th>
          <th>íŒ€ íƒ€ìœ¨</th>
          <th>íŒ€ ìì±…ì </th>
          <th>íŒ€ ë“ì </th>
          <th>íŒ€ íƒ€ì </th>
          <th>íŒ€ ìŠ¹ë¥ </th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <footer>ì‚¬ì´íŠ¸ ì•„ì´ë””ì–´ ê¸°íš ë° ê°œë°œ: ì´ì›ì¤€</footer>

<script>
  const PLAYER_JSON_URL = "https://alex4u-jun.github.io/bs_record/players.json";

  async function loadPlayersFromJson() {
    try {
      const res = await fetch(PLAYER_JSON_URL);
      if (!res.ok) throw new Error("ì„ ìˆ˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
      return await res.json();
    } catch (err) {
      console.error("fetch ì‹¤íŒ¨:", err);
      return [];
    }
  }

  const goToInputBtn = document.getElementById('goToInputBtn');
  const hitterMenu = document.getElementById('hitterMenu');
  const pitcherMenu = document.getElementById('pitcherMenu');
  const rankingContent = document.getElementById('rankingContent');
  const searchInput = document.getElementById('searchInput');
  const mvpText = document.getElementById('mvpText');
  const playerName = document.getElementById('playerName');
  const playerInfo = document.getElementById('playerInfo');
  const mvpRankingSection = document.getElementById('mvpRankingSection');
  const mvpRankingTableBody = document.querySelector('#mvpRankingTable tbody');
  const teamStatsSection = document.getElementById('teamStatsSection');
  const teamStatsTableBody = document.querySelector('#teamStatsTable tbody');

  const hitterStatsForRanking = ['íƒ€ìœ¨', 'í™ˆëŸ°', 'ì¶œë£¨ìœ¨', 'OPS', 'íƒ€ì ', 'WAR'];
  const pitcherStatsForRanking = ['ìŠ¹ë¦¬', 'ì„¸ì´ë¸Œ', 'í™€ë“œ', 'ì‚¼ì§„', 'ERA', 'WHIP'];

  // ê¸°ë³¸ ì •ë ¬: ì•„ë˜ ëª©ë¡ì€ ë‚´ë¦¼ì°¨ìˆœ, ë‚˜ë¨¸ì§€(ERA, WHIP)ëŠ” ì˜¤ë¦„ì°¨ìˆœ
  function isDescPreferred(stat){
    return ['íƒ€ìœ¨','í™ˆëŸ°','ì¶œë£¨ìœ¨','OPS','íƒ€ì ','ìŠ¹ë¦¬','ì„¸ì´ë¸Œ','í™€ë“œ','ì‚¼ì§„','WAR'].includes(stat);
  }
  let currentSort = { column: null, asc: true };

  /* ìµœê·¼ MVP ë°°ë„ˆ ë¡œë“œ */
  function loadRecentMvp() {
    const mvpData = localStorage.getItem('lastMvp');
    if (mvpData) {
      const mvp = JSON.parse(mvpData);
      mvpText.innerHTML = 'MVP <span id="sportsBadge">SPORTS</span>';
      playerName.textContent = mvp.name;
      playerInfo.textContent = `(${mvp.team} / ${mvp.type})`;
    }
  }

  /* ì´ë¦„ ê²€ìƒ‰ í•„í„° */
  function filterByName(players, keyword) {
    if (!keyword) return players;
    const lower = keyword.toLowerCase();
    return players.filter(p => p.name.toLowerCase().includes(lower));
  }

  /* ===== íƒ€ì/íˆ¬ìˆ˜ ì§€í‘œ ê³„ì‚° ===== */
  function calculateAB(p){
    const H = (p.stats['1ë£¨íƒ€']||0)+(p.stats['2ë£¨íƒ€']||0)+(p.stats['3ë£¨íƒ€']||0)+(p.stats['í™ˆëŸ°']||0);
    return H + (p.stats['ì‚¼ì§„']||0) + (p.stats['ë‚´ì•¼ë•…ë³¼']||0) + (p.stats['í”Œë¼ì´ì•„ì›ƒ']||0);
  }
  function calculatePA(p){ // íƒ€ì„ = AB + ë³¼ë„· + í¬ìƒí”Œë¼ì´
    const AB = calculateAB(p);
    const BB = p.stats['ë³¼ë„·']||0;
    const SF = p.stats['í¬ìƒí”Œë¼ì´']||0;
    return AB + BB + SF;
  }

  function calculateAVG(p) {
    const H = (p.stats['1ë£¨íƒ€']||0) + (p.stats['2ë£¨íƒ€']||0) + (p.stats['3ë£¨íƒ€']||0) + (p.stats['í™ˆëŸ°']||0);
    const AB = calculateAB(p);
    return AB ? H / AB : 0;
  }
  function calculateOBP(p) {
    const H = (p.stats['1ë£¨íƒ€']||0) + (p.stats['2ë£¨íƒ€']||0) + (p.stats['3ë£¨íƒ€']||0) + (p.stats['í™ˆëŸ°']||0);
    const BB = p.stats['ë³¼ë„·']||0;
    const AB = calculateAB(p);
    const SF = p.stats['í¬ìƒí”Œë¼ì´']||0;
    const denom = AB + BB + SF;
    return denom ? (H + BB) / denom : 0;
  }
  function calculateSLG(p) {
    const singles = (p.stats['1ë£¨íƒ€']||0);
    const doubles = p.stats['2ë£¨íƒ€']||0, triples = p.stats['3ë£¨íƒ€']||0, HR = p.stats['í™ˆëŸ°']||0;
    const AB = calculateAB(p);
    const TB = singles + doubles*2 + triples*3 + HR*4;
    return AB ? TB / AB : 0;
  }
  function calculateOPS(p) { return calculateOBP(p) + calculateSLG(p); }
  function calculateERA(p) {
    const ER = p.stats['ìì±…ì ']||0, IP = p.stats['ì´ë‹']||0;
    return IP ? (ER * 9) / IP : 0;
  }
  function calculateWHIP(p) {
    const BB = p.stats['ë³¼ë„·']||0, H = p.stats['í”¼ì•ˆíƒ€']||0, IP = p.stats['ì´ë‹']||0;
    return IP ? (BB + H) / IP : 0;
  }

  // ===== WAR(íƒ€ì) ê³„ì‚°: ê³µê²©ë ¥ë§Œ + ëŒ€ì²´ìˆ˜ì¤€ ê°€ì‚° =====
  const WAR_WEIGHTS = { single:0.90, double:1.25, triple:1.60, hr:2.00, bb:0.70 };
  const WOBASCALE = 1.15;        // wOBA â†’ ë“ì /PA í™˜ì‚° ìƒìˆ˜(ê·¼ì‚¬)
  const RUNS_PER_WIN = 10;       // 1ìŠ¹ë‹¹ ë“ì (ê·¼ì‚¬)
  const REPLACEMENT_PER_600PA = 20; // ëŒ€ì²´ìˆ˜ì¤€: í‰ê· ë³´ë‹¤ -20ì /600PA

  function wobaNumeratorFromStats(p){
    const s = p.stats||{};
    const singles = (s['1ë£¨íƒ€']||0);
    const doubles = (s['2ë£¨íƒ€']||0);
    const triples = (s['3ë£¨íƒ€']||0);
    const hr      = (s['í™ˆëŸ°']||0);
    const bb      = (s['ë³¼ë„·']||0);
    return singles*WAR_WEIGHTS.single + doubles*WAR_WEIGHTS.double +
           triples*WAR_WEIGHTS.triple + hr*WAR_WEIGHTS.hr + bb*WAR_WEIGHTS.bb;
  }
  function computeLeagueWoba(hitters){
    let num=0, den=0;
    hitters.forEach(h=>{
      num += wobaNumeratorFromStats(h);
      den += calculatePA(h);
    });
    return den? num/den : 0;
  }
  function buildWarMap(hittersAll){
    const leagueWoba = computeLeagueWoba(hittersAll);
    const map = {};
    hittersAll.forEach(p=>{
      const PA = calculatePA(p);
      if(!PA){ map[p.name]=0; return; }
      const woba = wobaNumeratorFromStats(p)/PA;
      const wRAA = (woba - leagueWoba)/WOBASCALE * PA;
      const repRuns = REPLACEMENT_PER_600PA * (PA/600);   // +20 * PA/600
      const WAR = (wRAA + repRuns) / RUNS_PER_WIN;
      map[p.name] = WAR;
    });
    return map;
  }

  function getStatValue(p, stat) {
    switch(stat) {
      case 'íƒ€ìœ¨': return calculateAVG(p);
      case 'ì¶œë£¨ìœ¨': return calculateOBP(p);
      case 'OPS': return calculateOPS(p);
      case 'í™ˆëŸ°': case 'íƒ€ì ': case 'ìŠ¹ë¦¬':
      case 'ì„¸ì´ë¸Œ': case 'í™€ë“œ': case 'ì‚¼ì§„':
        return p.stats[stat] || 0;
      case 'ERA': return calculateERA(p);
      case 'WHIP': return calculateWHIP(p);
      case 'WAR': return p.__war || 0;
      default: return 0;
    }
  }

  function getStatDisplay(p, stat) {
    const val = getStatValue(p, stat);
    if (['íƒ€ìœ¨', 'ì¶œë£¨ìœ¨', 'OPS', 'WHIP'].includes(stat)) return val.toFixed(3);
    if (stat === 'ERA') return val.toFixed(2);
    if (stat === 'WAR') return val.toFixed(1);
    return val;
  }

  /* ë©”ë‹¬ ì•„ì´ì½˜ */
  function getMedalIcon(index){
    if(index===0) return 'ğŸ¥‡';
    if(index===1) return 'ğŸ¥ˆ';
    if(index===2) return 'ğŸ¥‰';
    return '';
  }

  function createRankingTable(players, stat) {
    const table = document.createElement('table');
    const thead = document.createElement('thead');
    const tbody = document.createElement('tbody');

    const headerRow = document.createElement('tr');
    ['ìˆœìœ„', 'ì„ ìˆ˜ëª…', stat].forEach((t, i) => {
      const th = document.createElement('th');
      th.textContent = t;
      if (i === 2) {
        th.style.cursor = 'pointer';
        th.addEventListener('click', () => {
          currentSort.column = stat;
          currentSort.asc = !currentSort.asc;
          renderRanking(stat, currentSort.asc);
        });
        th.textContent += currentSort.asc ? ' â–²' : ' â–¼';
      }
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);

    players.forEach((p, i) => {
      const medal = getMedalIcon(i);
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="rank-cell">${medal ? `<span class="rank-medal">${medal}</span>` : ''}${i+1}</td>
        <td class="player-name" style="cursor:pointer;text-decoration:underline">${p.name}</td>
        <td>${getStatDisplay(p, stat)}</td>
      `;
      tr.querySelector('.player-name').onclick = () => {
        window.location.href = `player_detail.html?name=${encodeURIComponent(p.name)}&type=${encodeURIComponent(p.type)}`;
      };
      tbody.appendChild(tr);
    });

    table.appendChild(thead);
    table.appendChild(tbody);
    return table;
  }

  async function renderRanking(stat, asc = true) {
    rankingContent.innerHTML = '';
    const allPlayers = await loadPlayersFromJson();

    const isHitterStat = hitterStatsForRanking.includes(stat);
    let players = allPlayers.filter(p => isHitterStat ? p.type==='íƒ€ì' : p.type==='íˆ¬ìˆ˜');

    // WAR ê³„ì‚°(ì „ì²´ íƒ€ì ê¸°ì¤€)
    if (stat === 'WAR') {
      const hittersAll = allPlayers.filter(p=>p.type==='íƒ€ì');
      const warMap = buildWarMap(hittersAll);
      players.forEach(p => p.__war = warMap[p.name] || 0);
    }

    // ê²€ìƒ‰ì–´ í•„í„°
    const keyword = searchInput.value.trim();
    players = filterByName(players, keyword);

    // ì •ë ¬
    players.sort((a, b) => {
      const va = getStatValue(a, stat);
      const vb = getStatValue(b, stat);
      return asc ? (va - vb) : (vb - va);
    });

    rankingContent.appendChild(createRankingTable(players, stat));
  }

  async function renderMvpRanking() {
    const players = (await loadPlayersFromJson()).filter(p => p.mvpCount > 0);
    if (!players.length) return mvpRankingSection.style.display = 'none';
    mvpRankingSection.style.display = 'block';

    const mvpMap = {};
    players.forEach(p => {
      if (!mvpMap[p.name]) mvpMap[p.name] = { ...p, teams: [p.team], types: [p.type] };
      else {
        mvpMap[p.name].mvpCount += p.mvpCount;
        if (!mvpMap[p.name].teams.includes(p.team)) mvpMap[p.name].teams.push(p.team);
      }
    });

    const list = Object.values(mvpMap).sort((a,b) => b.mvpCount - a.mvpCount);
    mvpRankingTableBody.innerHTML = '';
    list.forEach((p, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${i+1}</td><td class="player-name" style="cursor:pointer;text-decoration:underline">${p.name}</td><td>${p.teams.join(', ')}</td><td>${p.mvpCount}</td>`;
      tr.querySelector('.player-name').onclick = () => {
        window.location.href = `player_detail.html?name=${encodeURIComponent(p.name)}&type=${encodeURIComponent(p.types[0])}`;
      };
      mvpRankingTableBody.appendChild(tr);
    });
  }

  async function calculateTeamStats() {
    const players = await loadPlayersFromJson();
    const teams = {};
    players.forEach(p => {
      const t = teams[p.team] ||= {
        totalHits: 0, totalAtBats: 0, totalER: 0, totalInnings: 0,
        totalRuns: 0, totalRBI: 0, totalWins: 0, totalLosses: 0
      };
      if (p.type === 'íƒ€ì') {
        const H = (p.stats['1ë£¨íƒ€']||0)+(p.stats['2ë£¨íƒ€']||0)+(p.stats['3ë£¨íƒ€']||0)+(p.stats['í™ˆëŸ°']||0);
        const AB = calculateAB(p);
        t.totalHits += H;
        t.totalAtBats += AB;
        t.totalRBI += p.stats['íƒ€ì '] || 0;
      }
      if (p.type === 'íˆ¬ìˆ˜') {
        t.totalER += p.stats['ìì±…ì ']||0;
        t.totalInnings += p.stats['ì´ë‹']||0;
        t.totalWins += p.stats['ìŠ¹ë¦¬']||0;
        t.totalLosses += p.stats['íŒ¨ë°°']||0;
      }
    });

    teamStatsTableBody.innerHTML = '';
    for (const [team, t] of Object.entries(teams)) {
      const avg = t.totalAtBats ? t.totalHits / t.totalAtBats : 0;
      const era = t.totalInnings ? (t.totalER * 9 / t.totalInnings) : 0;
      const winRate = (t.totalWins + t.totalLosses) ? t.totalWins / (t.totalWins + t.totalLosses) : 0;
      teamStatsTableBody.innerHTML += `
        <tr>
          <td>${team}</td>
          <td>${avg.toFixed(3)}</td>
          <td>${era.toFixed(2)}</td>
          <td>â€“</td>
          <td>${t.totalRBI}</td>
          <td>${(winRate*100).toFixed(1)}%</td>
        </tr>
      `;
    }
    teamStatsSection.style.display = 'block';
  }

  /* ë‹¤í¬ ëª¨ë“œ í† ê¸€ (ë¡œì»¬ ì €ì¥) */
  (function(){
    const root = document.documentElement;
    const btn = document.getElementById('themeToggle');
    const saved = localStorage.getItem('theme');
    if(saved){
      root.setAttribute('data-theme', saved);
      if(saved==='dark') btn.textContent='â˜€ï¸ ë¼ì´íŠ¸ ëª¨ë“œ';
    }
    btn.addEventListener('click', ()=>{
      const isDark = root.getAttribute('data-theme') === 'dark';
      const next = isDark ? '' : 'dark';
      if(next) root.setAttribute('data-theme', next); else root.removeAttribute('data-theme');
      localStorage.setItem('theme', next || '');
      btn.textContent = next==='dark' ? 'â˜€ï¸ ë¼ì´íŠ¸ ëª¨ë“œ' : 'ğŸŒ™ ë‹¤í¬ ëª¨ë“œ';
    });
  })();

  document.addEventListener('DOMContentLoaded', async () => {
    loadRecentMvp();
    await renderMvpRanking();
    await calculateTeamStats();
  });

  goToInputBtn.onclick = () => {
    const pw = prompt("ê¸°ë¡ ì…ë ¥ í˜ì´ì§€ ì ‘ê·¼ì„ ìœ„í•œ ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    if (pw === "Leaders0903") location.href = "index.html";
    else alert("ì•”í˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
  };

  function clearActiveMenu() {
    [...hitterMenu.children, ...pitcherMenu.children].forEach(li => li.classList.remove('active'));
  }

  hitterMenu.onclick = e => {
    if (e.target.tagName === 'LI') {
      clearActiveMenu();
      e.target.classList.add('active');
      const stat = e.target.dataset.stat;
      currentSort.column = stat;
      currentSort.asc = !isDescPreferred(stat);  // ê¸°ë³¸ ë°©í–¥ ì„¤ì •
      searchInput.value = '';
      renderRanking(currentSort.column, currentSort.asc);
    }
  };

  pitcherMenu.onclick = e => {
    if (e.target.tagName === 'LI') {
      clearActiveMenu();
      e.target.classList.add('active');
      const stat = e.target.dataset.stat;
      currentSort.column = stat;
      currentSort.asc = !isDescPreferred(stat);  // ê¸°ë³¸ ë°©í–¥ ì„¤ì •
      searchInput.value = '';
      renderRanking(currentSort.column, currentSort.asc);
    }
  };

  searchInput.oninput = () => {
    if (currentSort.column) renderRanking(currentSort.column, currentSort.asc);
  };
</script>

</body>
</html>

