<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CSIALeaders | ê¸°ë¡ì‹¤</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
/* ===================== THEME ===================== */
:root{
  --bg:#f6f8fd; --bg-grad1:#edf1ff;
  --text:#1f2937; --sub:#6b7280;
  --brand:#375dfb; --brand-2:#89a4ff;
  --card:#ffffff; --muted:#eef2ff; --border:#e5e7eb;
  --ring:rgba(55,93,251,.3); --good:#12b886; --bad:#ef4444;
  --shadow:0 10px 30px rgba(0,0,0,.06);
}
[data-theme="dark"]{
  /* ë‹¤í¬ëª¨ë“œ ëŒ€ë¹„ ê°•í™” + ê·¸ë¼ë°ì´ì…˜ ìœ ì§€ */
  --bg:#0b1224; --bg-grad1:#070f22;
  --text:#e9f1ff; --sub:#bcd0ff;
  --brand:#8fb2ff; --brand-2:#a7c2ff;
  --card:#0f1a30; --muted:#162347; --border:#243565;
  --ring:rgba(143,178,255,.35);
  --shadow:0 12px 30px rgba(0,0,0,.45);
}
*{ box-sizing:border-box }
html,body{ height:100% }
body{
  margin:0; color:var(--text);
  background: radial-gradient(120% 120% at 0% 0%, var(--bg-grad1) 0%, var(--bg) 55%) fixed;
  font-family: Pretendard, system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', sans-serif;
}

/* ===================== TOP NAV ===================== */
.header{
  position:sticky; top:0; z-index:50;
  background:rgba(255,255,255,.55); backdrop-filter:saturate(180%) blur(14px);
  border-bottom:1px solid var(--border);
}
[data-theme="dark"] .header{ background:rgba(15,26,46,.6) }

.wrap{ max-width:1180px; margin:0 auto; padding:14px 16px; }
.brand{ font-weight:900; letter-spacing:.2px; font-size:22px; color:var(--brand); text-decoration:none }
.nav{ display:flex; gap:8px; align-items:center; width:100%; justify-content:space-between }

.tabs{ display:flex; gap:8px; flex-wrap:wrap; }
.tab{
  padding:8px 14px; border-radius:999px; color:var(--sub); font-weight:800; cursor:pointer;
  border:1px solid transparent; transition:.15s; user-select:none;
}
.tab.active{ color:#fff; background:var(--brand); box-shadow:0 6px 18px var(--ring); }
.tab:hover{ color:var(--brand); background:var(--muted) }

.iconbtn{
  border:1.5px solid var(--border); background:var(--card); color:var(--text);
  border-radius:12px; padding:8px 10px; cursor:pointer; box-shadow:var(--shadow);
}
.iconbtn.primary{ background:var(--brand); color:#fff; border-color:transparent }
.iconbtn:hover{ transform:translateY(-1px) }

/* ===================== GRID ===================== */
.section{ max-width:1180px; margin:18px auto; padding:0 16px; }
.grid{ display:grid; grid-template-columns: repeat(12, 1fr); gap:14px; }
.card{
  grid-column: span 6 / span 6;
  background:var(--card); border:1px solid var(--border); border-radius:18px; box-shadow:var(--shadow);
  padding:18px;
}
.card.sm{ grid-column: span 3 / span 3; }
.card.lg{ grid-column: 1 / -1; }
.card h3{ margin:0 0 6px; font-size:28px; letter-spacing:.2px }
.card .sub{ color:var(--sub); font-weight:700 }

/* ===================== HOME â€“ Tiles ===================== */
.tile{
  display:flex; align-items:center; justify-content:center; min-height:120px;
  border:1px dashed var(--border); border-radius:16px; background:linear-gradient(180deg, rgba(255,255,255,.6), rgba(255,255,255,.1));
  font-size:22px; font-weight:900; letter-spacing:.2px; color:#3443a8; text-align:center;
}
[data-theme="dark"] .tile{ color:#cfe0ff; background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); }
.tile .sub{ display:block; font-size:13px; margin-top:4px; color:var(--sub); font-weight:700 }
.tile:hover{ outline:3px solid var(--ring) }

/* ===================== HOME â€“ Scoreboard & MVP ===================== */
.scoreboard{
  border-radius:18px; overflow:hidden; padding:28px; color:#e8f0ff;
  background: radial-gradient(140% 110% at 0% 0%, #0f1a35, #0a1228);
  border:1px solid rgba(255,255,255,.06); box-shadow:inset 0 0 40px rgba(255,255,255,.08), var(--shadow);
  min-height:220px; display:flex; align-items:center; justify-content:center;
}
.sb-inner{ text-align:center }
.sb-line{
  display:flex; align-items:center; gap:14px; font-weight:1000;
  font-size:40px; flex-wrap:nowrap; justify-content:center; white-space:nowrap;
}
.sb-badge{ padding:6px 14px; border-radius:999px; background:rgba(255,255,255,.12); font-size:28px }
.sb-away{ color:#6aa4ff; text-shadow:0 0 6px rgba(106,164,255,.4) }
.sb-home{ color:#ff7b7b; text-shadow:0 0 6px rgba(255,123,123,.4) }
.sb-date{ display:block; margin-bottom:8px; font-weight:800; color:#bcd3ff }

/* MVP banner (ì‘ê²Œ) */
#mvpBanner{
  display:grid; place-items:center; min-height:120px;
  background:linear-gradient(135deg,#2f67ff 0 50%,#ff2f59 50% 100%); color:#fff;
  border-radius:18px;
}
#mvpMain{ font-size:34px; font-weight:1000; line-height:1; text-shadow:0 4px 16px rgba(0,0,0,.35); white-space:nowrap }
#mvpSub{ font-weight:800; opacity:.9; margin-top:6px }

/* ===================== TABLE ===================== */
.table{ width:100%; border-collapse:collapse; table-layout:fixed; }
th,td{ border:1px solid var(--border); padding:10px 12px; text-align:center; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
th{ position:sticky; top:0; background:var(--muted); color:#2d3f9e; font-weight:900; z-index:1 }
[data-theme="dark"] th{ color:#d5e3ff; }
td.name{ color:#2f5bff; font-weight:800; cursor:pointer; text-decoration:underline }

/* H2H: ê¸´ ì¹¸ ì¤„ë°”ê¿ˆ & ì¶•ì†Œ */
#h2hTable th, #h2hTable td{ white-space:normal; overflow:visible; text-overflow:clip; }
#h2hTable td.compact, #h2hTable th.compact{ font-size:.92em; line-height:1.15; word-break:break-word; }
#h2hTools{ display:flex; align-items:center; gap:10px; }
#h2hTools .spacer{ flex:1 1 auto; }   /* ê²€ìƒ‰ ë²„íŠ¼ ì˜¤ë¥¸ìª½ìœ¼ë¡œ */

/* ========= ê°€ë¡œ ìŠ¤í¬ë¡¤ ìœ í‹¸ (ë””ìì¸ ìœ ì§€í•˜ë©° ê¸°ëŠ¥ë§Œ ì¶”ê°€) ========= */
.scroll-x{ overflow-x:auto; -webkit-overflow-scrolling:touch; }
.wide-table{ table-layout:auto; min-width:980px; }
.wide-table th, .wide-table td{ white-space:nowrap; overflow:visible; text-overflow:clip; }

/* helpers */
.row{ display:grid; grid-template-columns:repeat(3,minmax(140px,1fr)); gap:10px }
.row-2{ display:grid; grid-template-columns:repeat(2,minmax(140px,1fr)); gap:10px }
.tools{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:10px }
.pill{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:var(--muted); font-weight:800; color:#31406f }
[data-theme="dark"] .pill{ color:#cfe0ff }
.badge{ padding:5px 10px; border-radius:999px; border:1px solid var(--border); background:var(--muted); color:#2d3f9e; font-weight:900 }
[data-theme="dark"] .badge{ color:#d5e3ff }
input,select{ width:100%; padding:10px; border-radius:12px; border:1.5px solid var(--border); background:var(--card); color:var(--text) }
.no-data{ text-align:center; color:var(--sub); padding:16px }

/* disclosure */
details.disclosure{ border:1px solid var(--border); border-radius:14px; background:var(--card); box-shadow:var(--shadow); overflow:hidden; margin-top:10px }
details.disclosure summary{
  list-style:none; cursor:pointer; user-select:none; padding:12px 14px; font-weight:900; background:linear-gradient(180deg, var(--muted), transparent);
  display:flex; align-items:center; justify-content:space-between;
}
details.disclosure[open] summary{ border-bottom:1px solid var(--border) }

/* Member cards */
.people-grid{ display:grid; gap:10px; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); margin-top:12px; }
.person-card{ background:var(--card); border:1px solid var(--border); border-radius:14px; padding:14px; box-shadow:var(--shadow); transition:.15s; }
.person-card:hover{ transform:translateY(-2px); box-shadow:0 12px 24px rgba(55,93,251,.12) }
.person-name{ font-weight:900; margin-bottom:6px }
.person-sub{ color:var(--sub); font-weight:700; font-size:.95rem }

/* schedule list cards */
.game-card{ margin-top:12px; border-radius:16px; border:1px solid var(--border); background:var(--card); box-shadow:var(--shadow); padding:14px }
.game-head{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:space-between }
.game-title{ font-weight:900 }
.score-pill{ display:inline-flex; gap:6px; align-items:center; padding:6px 10px; border-radius:999px; background:var(--muted); font-weight:900 }

/* ==== ê¸°ë¡/í†µê³„ ìƒë‹¨ íˆ´ë°” ë¦¬ë””ìì¸ ==== */
.tools.column{ display:flex; flex-direction:column; gap:18px; }
.menu-row{ display:flex; align-items:center; gap:22px; flex-wrap:wrap; }

.chip-label{
  border:1.5px solid var(--border);
  background:var(--muted);
  color:var(--text);
  padding:8px 14px;
  border-radius:999px;
  font-weight:900;
  cursor:pointer;
  box-shadow:var(--shadow);
}
.chip-label.active{
  background:var(--brand);
  color:#fff;
  border-color:transparent;
  box-shadow:0 8px 20px var(--ring);
}

.menu-chips{
  list-style:none; display:flex; gap:28px; flex-wrap:wrap; margin:0; padding:0;
}
.menu-chips .tab{
  padding:0; border:none; background:none; cursor:pointer;
  color:var(--text); font-weight:900; letter-spacing:.2px;
  opacity:.75; transition:opacity .15s, transform .04s;
}
.menu-chips .tab:hover{ opacity:1; transform:translateY(-1px); }
.menu-chips .tab.active{ opacity:1; color:var(--brand); }

/* ëª¨ë°”ì¼ ê°„ê²© ë¯¸ì„¸ì¡°ì • */
@media (max-width:560px){
  .menu-chips{ gap:18px; }
}


/* ===================== MOBILE LAYOUT (<=560px) ===================== */
@media (max-width: 560px){
  .wrap{ padding:10px 12px }
  /* í—¤ë” 3ì¤„ ë ˆì´ì•„ì›ƒ */
  .topbar{
    display:grid; grid-template-rows:auto auto auto; gap:8px;
  }
  .brand{ font-size:20px }
  .tabs{
    display:grid; grid-template-columns:repeat(5,1fr); gap:6px;
  }
  .tab{ padding:8px 8px; text-align:center }
  .actions-row{
    display:flex; gap:8px; justify-content:flex-end;
  }
  /* ìƒë‹¨ ë°”ê°€ ê³µê°„ ì°¨ì§€ ì¤„ì´ë„ë¡ */
  .header{ border-bottom-width:0.5px }
  .tile{ min-height:90px; font-size:18px }
  .card{ padding:14px }
  .section{ margin:12px auto }
  /* ì ìˆ˜íŒ í•œ ì¤„ ê°•ì œ + í¬ê¸° ìë™ì¡°ì ˆ */
  .sb-line{ font-size:clamp(18px, 6vw, 30px); gap:10px }
  .sb-badge{ font-size:clamp(16px, 5vw, 24px); padding:4px 10px }
  .sb-date{ font-size:12px }
  /* MVP í•œ ì¤„ */
  #mvpMain{ font-size:clamp(18px, 7vw, 26px) }
  #mvpBanner{ min-height:90px }

  /* MVP ìˆœìœ„: í‘œ í¬ê¸°ëŠ” ìœ ì§€, ê¸€ì”¨/íŒ¨ë”©ë§Œ ì¶•ì†Œ (ì˜ë¦¼ ë°©ì§€) */
  #mvpRankingTable th, #mvpRankingTable td{
    font-size:12px; padding:6px 4px;
    white-space:nowrap; overflow:visible; text-overflow:clip;
  }
}

/* ===================== DESKTOP RESPONSIVE ===================== */
@media (max-width: 880px){
  .grid{ grid-template-columns: repeat(6, 1fr) }
  .card{ grid-column: 1 / -1 }
  .row,.row-2{ grid-template-columns:1fr }
}
.vote-btn{
  border:1px solid var(--border);
  border-radius:999px;
  padding:4px 8px;
  background:var(--brand);
  color:#fff;
  font-weight:700;
  margin-left:8px;
  cursor:pointer;
}
.vote-btn:hover{ background:var(--brand-2); }
</style>
</head>
<body>
  <!-- ===================== HEADER ===================== -->
  <div class="header">
    <div class="wrap topbar">
      <!-- 1ì¤„: ë¸Œëœë“œ -->
      <div><a href="#" id="brandHome" class="brand">CSIALeaders</a></div>

      <!-- 2ì¤„: 5ê°œ íƒ­ ë™ì¼ í¬ê¸° -->
      <div class="tabs">
        <span class="tab active" data-target="home">í™ˆ</span>
        <span class="tab" data-target="member">ë¶€ì› ì†Œê°œ</span>
        <span class="tab" data-target="record">ê¸°ë¡ ë° í†µê³„</span>
        <span class="tab" data-target="h2h">ë§¤ì¹˜ì—… ê²€ìƒ‰</span>
        <span class="tab" data-target="games">ê²½ê¸°</span>
      </div>

      <!-- 3ì¤„: ìš°ì¸¡ ì •ë ¬ ì•¡ì…˜ -->
      <div class="actions-row">
        <button id="themeToggle" class="iconbtn" title="í…Œë§ˆ ì „í™˜">ğŸŒ™</button>
        <button id="goToInput" class="iconbtn primary">ê¸°ë¡ ì…ë ¥</button>
      </div>
    </div>
  </div>

  <!-- ===================== HOME ===================== -->
  <section class="section" id="sec-home">
    <div class="grid">
      <!-- 4 tiles -->
      <a class="card sm tile" data-goto="record">stats<span class="sub">ê¸°ë¡ ë° í†µê³„</span></a>
      <a class="card sm tile" data-goto="h2h">H2H<span class="sub">ë§¤ì¹˜ì—… ê²€ìƒ‰</span></a>
      <a class="card sm tile" data-goto="games">games<span class="sub">ê²½ê¸° ì¼ì •/ê²°ê³¼</span></a>
      <a class="card sm tile" data-goto="member">member<span class="sub">ë¶€ì› ì†Œê°œ</span></a>

      <!-- Big Scoreboard -->
      <div class="card lg scoreboard">
        <div class="sb-inner">
          <span class="sb-date" id="sb-date">2025-09-19</span>
          <div class="sb-line">
            <span class="sb-away" id="sb-away">CSIA</span>
            <span class="sb-badge" id="sb-away-score">1</span>
            <span style="opacity:.75; font-weight:900">:</span>
            <span class="sb-badge" id="sb-home-score">5</span>
            <span class="sb-home" id="sb-home">Leaders</span>
          </div>
        </div>
      </div>

      <!-- Small MVP banner -->
      <div class="card lg" id="mvpBanner">
        <div style="text-align:center">
          <div id="mvpMain">MVP: ì§„ìŠ¹ìš°</div>
          <div id="mvpSub">(Leaders/íƒ€ì)</div>
        </div>
      </div>
    </div>
    <div class="card lg" id="mvpVoteBox">
        <h3>MVP íˆ¬í‘œ</h3>
        <div class="sub">ì˜¤ëŠ˜ì˜ MVPë¥¼ ì§ì ‘ íˆ¬í‘œí•˜ì„¸ìš”! (ë¸Œë¼ìš°ì €ë‹¹ í•˜ë£¨ 1í‘œ)</div>
        <table class="table">
          <thead><tr><th>ì„ ìˆ˜</th><th>íŒ€</th><th>íˆ¬í‘œ</th></tr></thead>
          <tbody>
            <tr><td>ì§„ìŠ¹ìš°</td><td>Leaders</td><td><button class="vote-btn" onclick="sendVote('ì§„ìŠ¹ìš°','Leaders')">íˆ¬í‘œ</button></td></tr>
            <tr><td>ì´ë™ê¶Œ</td><td>CSIA</td><td><button class="vote-btn" onclick="sendVote('ì´ë™ê¶Œ','CSIA')">íˆ¬í‘œ</button></td></tr>
          </tbody>
        </table>
        <p style="font-weight:700; margin-top:10px">ì‹¤ì‹œê°„ ì§‘ê³„ ê²°ê³¼:</p>
        <ul id="mvpVoteResults" style="list-style:none; padding:0; font-weight:800"></ul>
      </div>
    </div>
  </section>

  <!-- ===================== MEMBER ===================== -->
  <section class="section" id="sec-member" hidden>
    <div class="card lg">
      <h3>ë¶€ì› ì†Œê°œ</h3>
      <div class="sub">ì†Œì† íŒ€ Â· í¬ì§€ì…˜ Â· í•™ë…„ Â· ë°˜ Â· ë‚˜ì´</div>
      <div class="tools" style="margin-top:10px">
        <input id="memSearch" placeholder="ì´ë¦„ ê²€ìƒ‰" />
        <select id="memTeam"><option value="">íŒ€ ì „ì²´</option></select>
        <select id="memPos"><option value="">í¬ì§€ì…˜ ì „ì²´</option></select>
      </div>
      <div class="people-grid" id="memberGrid"></div>
      <p class="no-data" id="memberNo">ë°ì´í„° ë¡œë”© ì¤‘â€¦</p>
    </div>
  </section>

  <!-- ===================== RECORD ===================== -->
  <section class="section" id="sec-record" hidden>
    <div class="grid">
      <div class="card lg">
        <h3>ê¸°ë¡ ë° í†µê³„</h3>
        <div class="sub">ì´ë¦„ì„ ê²€ìƒ‰í•˜ë©´ í•´ë‹¹ ì„ ìˆ˜ì˜ ëª¨ë“  ìŠ¤íƒ¯ê³¼ ê° í•­ëª©ì˜ ìˆœìœ„ê°€ í•œ ë²ˆì— í‘œì‹œë©ë‹ˆë‹¤. íŠ¹ì • ë¶„ì•¼ë¥¼ ì„ íƒí•˜ë©´ ì „ì²´ ë­í‚¹ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.</div>
        <div class="tools column" id="statToolbar">
  <input id="searchInput" placeholder="ì„ ìˆ˜ ì´ë¦„ ê²€ìƒ‰ (ì‹¤ì‹œê°„)" style="max-width:340px">

  <!-- 1ì¤„: íƒ€ì ë¶„ì•¼ -->
  <div class="menu-row">
    <button class="chip-label active" id="chipHit">íƒ€ì ë¶„ì•¼</button>
    <ul id="hitterMenu" class="menu-chips">
      <li class="tab" data-stat="íƒ€ìœ¨">íƒ€ìœ¨</li>
      <li class="tab" data-stat="í™ˆëŸ°">í™ˆëŸ°</li>
      <li class="tab" data-stat="ì¶œë£¨ìœ¨">ì¶œë£¨ìœ¨</li>
      <li class="tab" data-stat="OPS">OPS</li>
      <li class="tab" data-stat="íƒ€ì ">íƒ€ì </li>
      <li class="tab" data-stat="WAR">WAR</li>
    </ul>
  </div>

  <!-- 2ì¤„: íˆ¬ìˆ˜ ë¶„ì•¼ -->
  <div class="menu-row">
    <button class="chip-label" id="chipPit">íˆ¬ìˆ˜ ë¶„ì•¼</button>
    <ul id="pitcherMenu" class="menu-chips">
      <li class="tab" data-stat="ìŠ¹ë¦¬">ìŠ¹ë¦¬</li>
      <li class="tab" data-stat="ì„¸ì´ë¸Œ">ì„¸ì´ë¸Œ</li>
      <li class="tab" data-stat="í™€ë“œ">í™€ë“œ</li>
      <li class="tab" data-stat="ì‚¼ì§„">ì‚¼ì§„</li>
      <li class="tab" data-stat="ERA">ERA</li>
      <li class="tab" data-stat="WHIP">WHIP</li>
    </ul>
  </div>
</div>

      </div>

      <div class="card lg" id="rankingContent">
        <div class="no-data">ì´ë¦„ì„ ì…ë ¥í•˜ê±°ë‚˜, ìœ„ì—ì„œ ë¶„ì•¼ë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>
      </div>

      <div class="card lg" id="mvpRankBox">
        <h3>MVP ìˆœìœ„</h3>
        <table id="mvpRankingTable" class="table"><thead><tr><th>ìˆœìœ„</th><th>ì„ ìˆ˜ëª…</th><th>íŒ€</th><th>MVP</th></tr></thead><tbody><tr><td colspan="4" class="no-data">ë¡œë”© ì¤‘â€¦</td></tr></tbody></table>
      </div>

      <div class="card lg" id="teamStatsBox">
        <h3>íŒ€ë³„ ì£¼ìš” í†µê³„</h3>
        <!-- â¬‡ï¸ ê°€ë¡œ ìŠ¤í¬ë¡¤ ë˜í¼ ì¶”ê°€ -->
        <div class="scroll-x">
          <table id="teamStatsTable" class="table wide-table">
            <thead><tr><th>íŒ€ëª…</th><th>íŒ€ íƒ€ìœ¨</th><th>íŒ€ ERA</th><th>íŒ€ ë“ì </th><th>íŒ€ íƒ€ì </th><th>ìŠ¹ë¥ </th></tr></thead>
            <tbody><tr><td colspan="6" class="no-data">ë¡œë”© ì¤‘â€¦</td></tr></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- ===================== H2H ===================== -->
  <section class="section" id="sec-h2h" hidden>
    <div class="card lg">
      <h3>ë§¤ì¹˜ì—… ê²€ìƒ‰ (íˆ¬ìˆ˜â€“íƒ€ì)</h3>
      <div class="row-2" style="margin-top:10px">
        <div><label>íˆ¬ìˆ˜</label><input list="dlPitchers" id="h2hPitcher" placeholder="íˆ¬ìˆ˜ ì´ë¦„"/></div>
        <div><label>íƒ€ì</label><input list="dlHitters" id="h2hHitter" placeholder="íƒ€ì ì´ë¦„"/></div>
      </div>
      <datalist id="dlPitchers"></datalist><datalist id="dlHitters"></datalist>
      <div class="row-2" style="margin-top:8px">
        <div><label>ê²½ê¸°(ì„ íƒ)</label><select id="h2hGameSelect"><option value="">ì „ì²´ ê²½ê¸°</option></select></div>
        <div><label>ì •ë ¬</label><select id="h2hSort"><option value="time_desc">ìµœì‹ ìˆœ</option><option value="time_asc">ì˜¤ë˜ëœìˆœ</option><option value="inning">ì´ë‹ìˆœ</option></select></div>
      </div>
      <div id="h2hTools" class="tools">
        <span class="badge" id="h2hSummary">ëŒ€ê¸°ì¤‘</span>
        <span class="spacer"></span>
        <button class="iconbtn primary" id="h2hSearchBtn">ê²€ìƒ‰</button>
      </div>

      <!-- í‘œ 1: ì´ë²¤íŠ¸ ëª©ë¡ (ê°€ë¡œ ìŠ¤í¬ë¡¤) -->
      <div class="scroll-x">
        <table class="table wide-table" id="h2hTable" style="margin-top:10px;">
          <thead>
            <tr>
              <th class="compact">#</th>
              <th class="compact">ì‹œê°</th>
              <th class="compact">ê²½ê¸°</th>
              <th>ì´ë‹</th><th>ê³µê²©íŒ€</th><th>íƒ€ì</th><th>íˆ¬ìˆ˜</th><th>ê²°ê³¼</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- í‘œ 2: ì§‘ê³„ (ê°€ë¡œ ìŠ¤í¬ë¡¤) -->
      <div class="scroll-x" style="margin-top:10px">
        <table class="table wide-table" id="h2hAggTable">
          <thead><tr>
            <th>íƒ€ì„</th><th>1B</th><th>2B</th><th>3B</th><th>HR</th><th>BB</th><th>SO</th>
            <th>RBI</th><th>R</th><th>AVG</th><th>OBP</th><th>SLG</th><th>OPS</th>
          </tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- ===================== GAMES ===================== -->
  <section class="section" id="sec-games" hidden>
    <div class="card lg">
      <h3>ê²½ê¸° (ì¼ì • Â· ê²°ê³¼)</h3>
      <div id="gamesList"></div>
      <p id="gamesEmpty" class="no-data" hidden>í‘œì‹œí•  ê²½ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>
  </section>

  <footer class="section" style="opacity:.65; font-weight:700">ì‚¬ì´íŠ¸ ì•„ì´ë””ì–´Â·ê°œë°œ: ì´ì›ì¤€</footer>

<script>
/* ============= BASIC CONFIG ============= */
const SCOREBOARD = { date:'2025-09-19', awayTeam:'CSIA', awayScore:1, homeTeam:'Leaders', homeScore:5 };
const PLAYER_JSON_URL = "https://alex4u-jun.github.io/bs_record/players.json";
const MEMBER_JSON_URL = "https://alex4u-jun.github.io/bs_record/players_introduce.json"; // â¬…ï¸ ë¶€ì› ì†Œê°œ ì „ìš©
const GAMERECORD_JSON_URLS = [
  "https://alex4u-jun.github.io/bs_record/gamerecord_1.json",
  "https://alex4u-jun.github.io/bs_record/gamerecord_2.json",
  "https://alex4u-jun.github.io/bs_record/gamerecord_3.json",
  "https://alex4u-jun.github.io/bs_record/gamerecord_4.json",
];

/* ============= NAV / THEME ============= */
const tabs=[...document.querySelectorAll('.tab[data-target]')];
const sections={
  home:document.getElementById('sec-home'),
  member:document.getElementById('sec-member'),
  record:document.getElementById('sec-record'),
  h2h:document.getElementById('sec-h2h'),
  games:document.getElementById('sec-games')
};
function showSec(id){
  Object.values(sections).forEach(s=>s.hidden=true);
  tabs.forEach(t=>t.classList.toggle('active', t.dataset.target===id));
  (sections[id]||sections.home).hidden=false;
  window.scrollTo({top:0,behavior:'smooth'});
}
tabs.forEach(t=>t.addEventListener('click',()=>showSec(t.dataset.target)));
[...document.querySelectorAll('[data-goto]')].forEach(el=>el.onclick=()=>showSec(el.dataset.goto));
document.getElementById('brandHome').addEventListener('click',e=>{ e.preventDefault(); showSec('home'); });

const themeToggle=document.getElementById('themeToggle');
(function initTheme(){
  const root=document.documentElement;
  const saved=localStorage.getItem('theme');
  if(saved==='dark'){ root.setAttribute('data-theme','dark'); themeToggle.textContent='â˜€ï¸'; }
  themeToggle.onclick=()=>{
    const dark = root.getAttribute('data-theme')==='dark';
    if(dark){ root.removeAttribute('data-theme'); localStorage.setItem('theme',''); themeToggle.textContent='ğŸŒ™'; }
    else{ root.setAttribute('data-theme','dark'); localStorage.setItem('theme','dark'); themeToggle.textContent='â˜€ï¸'; }
  };
})();
document.getElementById('goToInput').onclick=()=>{
  const pw=prompt("ê¸°ë¡ ì…ë ¥ í˜ì´ì§€ ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”."); if(pw==="Leaders0903") location.href="index.html";
  else alert("ì•”í˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
};

/* ============= SCOREBOARD + MVP ============= */
document.getElementById('sb-date').textContent=SCOREBOARD.date;
document.getElementById('sb-away').textContent=SCOREBOARD.awayTeam;
document.getElementById('sb-away-score').textContent=String(SCOREBOARD.awayScore);
document.getElementById('sb-home').textContent=SCOREBOARD.homeTeam;
document.getElementById('sb-home-score').textContent=String(SCOREBOARD.homeScore);
(function loadMvpFromLocal(){
  const raw=localStorage.getItem('lastMvp');
  if(raw){ try{ const m=JSON.parse(raw); mvpMain.textContent=`MVP: ${m.name}`; mvpSub.textContent=`${m.team} Â· ${m.type}`; }catch{} }
})();

/* ============= DATA LOADERS ============= */
let __players=null;
async function loadPlayers(){
  if(__players) return __players;
  try{
    const r=await fetch(PLAYER_JSON_URL,{cache:'no-store'});
    __players=await r.json();
    return __players;
  }catch(e){ console.error(e); return []; }
}

/* â¬‡ï¸ ë¶€ì› ì†Œê°œ ì „ìš© ë¡œë” (introduce â†’ ì‹¤íŒ¨ ì‹œ players.json í´ë°± ë§¤í•‘) */
let __members = null;
async function loadMembers(){
  if(__members) return __members;
  try{
    const r = await fetch(MEMBER_JSON_URL, {cache:'no-store'});
    if(!r.ok) throw new Error('introduce not found');
    const arr = await r.json();
    __members = Array.isArray(arr) ? arr : [];
    return __members;
  }catch(_){
    // í´ë°±: players.jsonì„ ë©¤ë²„ ì¹´ë“œìš©ìœ¼ë¡œ ë³€í™˜
    const ps = await loadPlayers();
    __members = ps.map(p=>({
      name: p.name,
      team: p.team || '',
      position: p.position || p.type || '',
      grade: p.grade ?? '',
      class: p.class ?? '',
      age: p.age ?? ''
    }));
    return __members;
  }
}

async function loadGameRecordMerged(){
  try{
    const settled=await Promise.allSettled(GAMERECORD_JSON_URLS.map(u=>fetch(u,{cache:'no-store'})));
    const out={games:[],events:[]}; const gset=new Set(), eset=new Set();
    for(const s of settled){
      if(s.status!=='fulfilled' || !s.value.ok) continue;
      const j=await s.value.json();
      (j.games||[]).forEach(g=>{
        const id=String(g.gameId||g.id||'');
        if(!gset.has(id)){ gset.add(id); out.games.push(g); }
      });
      (j.events||[]).forEach(e=>{
        // ì¤‘ë³µ ì œê±°: gameId + id
        const gid=String(e.gameId||''); const eid=String(e.id||(e.createdAt??e.updatedAt??e.ts??Math.random()));
        const key = gid + "____" + eid;
        if(!eset.has(key)){ eset.add(key); out.events.push(e); }
      });
    }
    return out;
  }catch(e){ console.error(e); return {games:[],events:[]}; }
}
function normGame(g){
  const id=String(g.gameId||g.id||''); return { id, date:g.date||'', away:g.awayTeam||g.away||'CSIA', home:g.homeTeam||g.home||'Leaders' };
}
function normEvent(e){
  const ts = Number(e.ts ?? e.createdAt ?? e.updatedAt ?? 0);
  return {
    gameId:String(e.gameId || e.gid || ''), ts,
    inning:Number(e.inning), half:e.half||'',
    offense:e.offenseTeam||'', defense:e.defenseTeam||'',
    hitter:e.hitterName||'', pitcher:e.pitcherName||'',
    hitterEvent:e.hitterEvent||'', rbi:Number(e.rbiDelta||0), run:Number(e.runScoredDelta||0),
    pitcherEvent:e.pitcherEvent||'', pitchCount:Number(e.pitchCountDelta||0),
    inningsDelta:Number(e.inningsDelta||0), er:Number(e.earnedRunsDelta||0)
  };
}

/* ê³µìš© í¬ë§·í„° */
function fmtTs(ts){
  if(!ts) return '';
  const d=new Date(ts); if(isNaN(d)) return '';
  const mm=String(d.getMonth()+1).padStart(2,'0'), dd=String(d.getDate()).padStart(2,'0');
  const hh=String(d.getHours()).padStart(2,'0'), mi=String(d.getMinutes()).padStart(2,'0');
  return `${d.getFullYear()}-${mm}-${dd} ${hh}:${mi}`;
}
/* H2H ì „ìš© ì¶•ì•½ í¬ë§·í„° */
function fmtHHMM(ts){
  if(!ts) return ''; const d=new Date(ts); if(isNaN(d)) return '';
  const hh=String(d.getHours()).padStart(2,'0'); const mi=String(d.getMinutes()).padStart(2,'0'); return `${hh}:${mi}`;
}
function date8(str){ return (str||'').replaceAll('-',''); }
function gameIdToDate8(e, gamesMap){
  const g = gamesMap[e.gameId];
  if(g && g.date) return date8(g.date);
  const m = String(e.gameId).match(/(\d{4})-(\d{2})-(\d{2})/);
  return m ? `${m[1]}${m[2]}${m[3]}` : String(e.gameId);
}

/* ============= MEMBER (ì¹´ë“œ) ============= */
const memberGrid=document.getElementById('memberGrid'), memberNo=document.getElementById('memberNo');
const memSearch=document.getElementById('memSearch'), memTeam=document.getElementById('memTeam'), memPos=document.getElementById('memPos');

function mkCard(p){
  const team = p.team || '-';
  const pos  = p.position || p.type || '-';
  const num  = (p.backNumber && String(p.backNumber).trim() !== '') ? p.backNumber : '-';
  const age  = (p.age != null) ? `${p.age}ì„¸` :
               (p.school === 'MS' ? 'ì¤‘í•™ìƒ' : p.school === 'HS' ? 'ê³ ë“±í•™ìƒ' : '');

  const div = document.createElement('div');
  div.className = 'person-card';
  div.innerHTML = `
    <div class="person-name">${p.name}</div>
    <div class="person-sub">${team} Â· ${pos} Â· ${num} Â· ${age}</div>
  `;
  return div;
}


/** select ë°•ìŠ¤ë¥¼ ë°ì´í„°ì— ë§ì¶° ë™ì  ì„¸íŒ… (ì´ˆê¸° 1íšŒ) */
let __memberFiltersHydrated = false;
function hydrateMemberFilters(members){
  if(__memberFiltersHydrated) return;
  // íŒ€ ì˜µì…˜
  const teams = [...new Set(members.map(m=>m.team).filter(Boolean))].sort();
  memTeam.innerHTML = `<option value="">íŒ€ ì „ì²´</option>` + teams.map(t=>`<option>${t}</option>`).join('');
  // í¬ì§€ì…˜ ì˜µì…˜
  const poss = [...new Set(members.map(m=>(m.position||'').trim()).filter(Boolean))].sort();
  memPos.innerHTML = `<option value="">í¬ì§€ì…˜ ì „ì²´</option>` + poss.map(p=>`<option>${p}</option>`).join('');
  __memberFiltersHydrated = true;
}

async function renderMembers(){
  const members = await loadMembers();
  hydrateMemberFilters(members);

  memberNo.hidden = true;
  const kw = (memSearch.value||'').trim().toLowerCase();
  const t  = memTeam.value;
  const pos= memPos.value;

  const list = members.filter(p=>{
    const okKw = kw ? p.name.toLowerCase().includes(kw) : true;
    const okT  = t ? (p.team===t) : true;
    const okP  = pos ? ((p.position||'')===pos) : true;
    return okKw && okT && okP;
  });

  memberGrid.innerHTML = '';
  if(!list.length){
    memberNo.hidden = false;
    memberNo.textContent = 'ê²€ìƒ‰ëœ ë¶€ì›ì´ ì—†ìŠµë‹ˆë‹¤.';
    return;
  }
  list.forEach(p=>memberGrid.appendChild(mkCard(p)));
}
[memSearch, memTeam, memPos].forEach(el=>el.addEventListener('input', renderMembers));
renderMembers();

/* ============= RECORD (ë­í‚¹/ê°œì¸ìš”ì•½) ============= */
const rankingContent=document.getElementById('rankingContent');
const searchInput=document.getElementById('searchInput');
const hitterMenu=document.getElementById('hitterMenu');
const pitcherMenu=document.getElementById('pitcherMenu');

function calcAB(p){ const s=p.stats||{}, H=(s['1ë£¨íƒ€']||0)+(s['2ë£¨íƒ€']||0)+(s['3ë£¨íƒ€']||0)+(s['í™ˆëŸ°']||0); const OUT=(s['ì‚¼ì§„']||0)+(s['ë‚´ì•¼ë•…ë³¼']||0)+(s['í”Œë¼ì´ì•„ì›ƒ']||0); const ROE=(s['ìˆ˜ë¹„ ì‹¤ì±…']||0); return H+OUT+ROE; }
function PAof(p){ if(p.PA!=null) return +p.PA; const AB=calcAB(p), BB=(p.stats||{})['ë³¼ë„·']||0, SF=(p.stats||{})['í¬ìƒí”Œë¼ì´']||0; return AB+BB+SF; }
function AVG(p){ const s=p.stats||{}, H=(s['1ë£¨íƒ€']||0)+(s['2ë£¨íƒ€']||0)+(s['3ë£¨íƒ€']||0)+(s['í™ˆëŸ°']||0); const AB=calcAB(p); return AB? H/AB:0 }
function OBP(p){ const s=p.stats||{}, H=(s['1ë£¨íƒ€']||0)+(s['2ë£¨íƒ€']||0)+(s['3ë£¨íƒ€']||0)+(s['í™ˆëŸ°']||0); const BB=s['ë³¼ë„·']||0, AB=calcAB(p), SF=s['í¬ìƒí”Œë¼ì´']||0; const den=AB+BB+SF; return den? (H+BB)/den:0 }
function SLG(p){ const s=p.stats||{}, AB=calcAB(p); const TB=(s['1ë£¨íƒ€']||0)+2*(s['2ë£¨íƒ€']||0)+3*(s['3ë£¨íƒ€']||0)+4*(s['í™ˆëŸ°']||0); return AB? TB/AB:0 }
function OPS(p){ return OBP(p)+SLG(p) }
function ERA(p){ const s=p.stats||{}, ER=s['ìì±…ì ']||0, IP=s['ì´ë‹']||0; return IP? (ER*9)/IP:0 }
function WHIP(p){ const s=p.stats||{}, BB=s['ë³¼ë„·']||0, H=s['í”¼ì•ˆíƒ€']||0, IP=s['ì´ë‹']||0; return IP? (BB+H)/IP:0 }
const WWT={ single:.90,double:1.25,triple:1.6,hr:2,bb:.7 }, WOBASCALE=1.15, RPW=10, REP_PER_600=20;
function wobaNum(p){ const s=p.stats||{}; return (s['1ë£¨íƒ€']||0)*WWT.single + (s['2ë£¨íƒ€']||0)*WWT.double + (s['3ë£¨íƒ€']||0)*WWT.triple + (s['í™ˆëŸ°']||0)*WWT.hr + (s['ë³¼ë„·']||0)*WWT.bb }
function leagueWoba(hitters){ let num=0, den=0; hitters.forEach(h=>{ num+=wobaNum(h); den+=PAof(h); }); return den? num/den:0 }
function buildWar(hitters){ const L=leagueWoba(hitters), map={}; hitters.forEach(p=>{ const pa=PAof(p)||0; if(!pa) return map[p.name]=0; const woba=wobaNum(p)/pa; const wRAA=(woba-L)/WOBASCALE*pa; const rep=REP_PER_600*(pa/600); map[p.name]=(wRAA+rep)/RPW; }); return map; }
function getVal(p,stat){ switch(stat){ case 'íƒ€ìœ¨':return AVG(p); case 'ì¶œë£¨ìœ¨':return OBP(p); case 'OPS':return OPS(p); case 'í™ˆëŸ°': case 'íƒ€ì ': case 'ìŠ¹ë¦¬': case 'ì„¸ì´ë¸Œ': case 'í™€ë“œ': case 'ì‚¼ì§„': return (p.stats||{})[stat]||0; case 'ERA':return ERA(p); case 'WHIP':return WHIP(p); case 'WAR':return p.__war||0; default:return 0; } }
function dispVal(p,stat){ const v=getVal(p,stat); if(['íƒ€ìœ¨','ì¶œë£¨ìœ¨','OPS','WHIP'].includes(stat)) return v.toFixed(3); if(stat==='ERA') return v.toFixed(2); if(stat==='WAR') return v.toFixed(1); return v; }
function medal(i){ return i===0?'ğŸ¥‡':i===1?'ğŸ¥ˆ':i===2?'ğŸ¥‰':'' }
let __pctCut=0;
function pctCut(players,p=.7){ const list=players.filter(p=>p.type==='íƒ€ì').map(PAof).filter(x=>Number.isFinite(x)&&x>=0).sort((a,b)=>a-b); if(!list.length) return 0; const idx=Math.floor((list.length-1)*(1-p)); return Math.max(list[idx],0); }
function isAscPreferred(stat){ return ['ERA','WHIP'].includes(stat) }

function tableRanking(players, stat, nonQ){
  const t=document.createElement('table'); t.className='table';
  t.innerHTML=`<thead><tr><th>ìˆœìœ„</th><th>ì„ ìˆ˜</th><th>${stat}</th></tr></thead><tbody></tbody>`;
  const tb=t.querySelector('tbody');
  players.forEach((p,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${medal(i)}${i+1}</td><td class="name">${p.name}</td><td>${dispVal(p,stat)}</td>`;
    tr.querySelector('.name').onclick=()=>location.href=`player_detail.html?name=${encodeURIComponent(p.name)}&type=${encodeURIComponent(p.type)}`;
    tb.appendChild(tr);
  });
  if(nonQ && nonQ.length){
    const sep=document.createElement('tr'); sep.innerHTML=`<td colspan="3" style="font-weight:900;color:#b02">ê·œì • ë¯¸ë‹¬</td>`; tb.appendChild(sep);
    nonQ.forEach(p=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>â€“</td><td class="name">${p.name}</td><td>${dispVal(p,stat)}</td>`;
      tr.querySelector('.name').onclick=()=>location.href=`player_detail.html?name=${encodeURIComponent(p.name)}&type=${encodeURIComponent(p.type)}`;
      tb.appendChild(tr);
    });
  }
  return t;
}
function applyQual(list,stat){
  const isH=['íƒ€ìœ¨','í™ˆëŸ°','ì¶œë£¨ìœ¨','OPS','íƒ€ì ','WAR'].includes(stat);
  const A=[], B=[];
  list.forEach(p=>{
    if(isH){ const need=__pctCut; const have=PAof(p); (have>=need?A:B).push(p); }
    else{ A.push(p); }
  });
  return {A,B};
}
async function renderRanking(stat, asc){
  const all=await loadPlayers();
  const isH=['íƒ€ìœ¨','í™ˆëŸ°','ì¶œë£¨ìœ¨','OPS','íƒ€ì ','WAR'].includes(stat);
  let list=all.filter(p=> isH ? p.type==='íƒ€ì' : p.type==='íˆ¬ìˆ˜');
  if(stat==='WAR'){ const map=buildWar(all.filter(p=>p.type==='íƒ€ì')); list.forEach(p=>p.__war=map[p.name]||0) }
  list.sort((a,b)=>{
    const va=getVal(a,stat), vb=getVal(b,stat);
    if(asc) return va-vb;
    if(vb!==va) return vb-va;
    return (isH ? (PAof(b)-PAof(a)) : (((b.stats||{})['ì´ë‹']||0)-((a.stats||{})['ì´ë‹']||0)));
  });
  const {A,B}=applyQual(list,stat);
  rankingContent.innerHTML=''; rankingContent.appendChild(tableRanking(A,stat,B));
}

/* ê°œì¸ ìš”ì•½ + í•­ëª©ë³„ ìˆœìœ„ */
function playerSummaryHTML(p, all){
  const Hstats = ['íƒ€ìœ¨','ì¶œë£¨ìœ¨','OPS','í™ˆëŸ°','íƒ€ì ','WAR'];
  const Pstats = ['ERA','WHIP','ìŠ¹ë¦¬','ì„¸ì´ë¸Œ','í™€ë“œ','ì‚¼ì§„'];
  const warMap = buildWar(all.filter(x=>x.type==='íƒ€ì'));
  if(p.type==='íƒ€ì') p.__war = warMap[p.name]||0;

  function rankOf(stat){
    const pool = all.filter(x => (Hstats.includes(stat) ? x.type==='íƒ€ì' : x.type==='íˆ¬ìˆ˜'))
                    .map(x => ({name:x.name, val:getVal(x,stat)}));
    pool.sort((a,b)=> (['ERA','WHIP'].includes(stat)? a.val-b.val : b.val-a.val));
    const idx = pool.findIndex(z=>z.name===p.name);
    return idx<0 ? '-' : (idx+1);
  }
  function row(stat){ return `<tr><td>${stat}</td><td>${dispVal(p,stat)}</td><td>${rankOf(stat)}</td></tr>`; }
  const rows = (p.type==='íƒ€ì'?Hstats:Pstats).map(row).join('');
  return `<h3 style="margin:0 0 8px">${p.name} Â· <span class="sub">${p.team} Â· ${p.type}</span></h3>
          <table class="table" style="margin-top:8px">
            <thead><tr><th>í•­ëª©</th><th>ê°’</th><th>ìˆœìœ„</th></tr></thead>
            <tbody>${rows}</tbody>
          </table>`;
}
async function renderBySearch(){
  const kw=(searchInput.value||'').trim().toLowerCase();
  if(!kw){ rankingContent.innerHTML='<div class="no-data">ì´ë¦„ì„ ì…ë ¥í•˜ê±°ë‚˜, ìœ„ì—ì„œ ë¶„ì•¼ë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>'; return; }
  const all=await loadPlayers();
  const matches = all.filter(p=>p.name.toLowerCase().includes(kw));
  if(!matches.length){ rankingContent.innerHTML='<div class="no-data">í•´ë‹¹ ì„ ìˆ˜ ì—†ìŒ</div>'; return; }
  rankingContent.innerHTML = matches.map(p=>`<div style="margin-bottom:12px">${playerSummaryHTML(p, all)}</div>`).join('');
}
searchInput.addEventListener('input', ()=>{
  if(searchInput.value.trim()){
    [...hitterMenu.children, ...pitcherMenu.children].forEach(x=>x.classList.remove('active'));
    renderBySearch();
  }else{
    rankingContent.innerHTML='<div class="no-data">ì´ë¦„ì„ ì…ë ¥í•˜ê±°ë‚˜, ìœ„ì—ì„œ ë¶„ì•¼ë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>';
  }
});
hitterMenu.onclick=e=>{
  if(e.target.dataset.stat){
    searchInput.value='';
    [...hitterMenu.children, ...pitcherMenu.children].forEach(x=>x.classList.remove('active'));
    e.target.classList.add('active');
    renderRanking(e.target.dataset.stat, ['ERA','WHIP'].includes(e.target.dataset.stat));
  }
};
pitcherMenu.onclick=e=>{
  if(e.target.dataset.stat){
    searchInput.value='';
    [...hitterMenu.children, ...pitcherMenu.children].forEach(x=>x.classList.remove('active'));
    e.target.classList.add('active');
    renderRanking(e.target.dataset.stat, ['ERA','WHIP'].includes(e.target.dataset.stat));
  }
};
(async()=>{ __players=await loadPlayers(); __pctCut=pctCut(__players); })();

/* MVP & íŒ€ í†µê³„ */
const mvpTbody=document.querySelector('#mvpRankingTable tbody');
const teamTbody=document.querySelector('#teamStatsTable tbody');
(async function renderMvpAndTeam(){
  try{
    const ps=await loadPlayers();
    const mv=ps.filter(p=>p.mvpCount>0);
    if(mv.length){
      const map={}; mv.forEach(p=>{ if(!map[p.name]) map[p.name]={...p}; else map[p.name].mvpCount+=p.mvpCount; });
      const arr=Object.values(map).sort((a,b)=>b.mvpCount-a.mvpCount);
      mvpTbody.innerHTML=arr.map((p,i)=>`<tr><td>${i+1}</td><td class="name">${p.name}</td><td>${p.team}</td><td>${p.mvpCount}</td></tr>`).join('');
    }else{
      mvpTbody.innerHTML=`<tr><td colspan="4" class="no-data">MVP ë°ì´í„° ì—†ìŒ</td></tr>`;
    }
    const teams={};
    ps.forEach(p=>{
      const t=teams[p.team] ||= { H:0, AB:0, ER:0, IP:0, RBI:0, W:0, L:0 };
      if(p.type==='íƒ€ì'){ const s=p.stats||{}; t.H += (s['1ë£¨íƒ€']||0)+(s['2ë£¨íƒ€']||0)+(s['3ë£¨íƒ€']||0)+(s['í™ˆëŸ°']||0); t.AB += calcAB(p); t.RBI += (s['íƒ€ì ']||0); }
      else{ const s=p.stats||{}; t.ER += (s['ìì±…ì ']||0); t.IP += (s['ì´ë‹']||0); t.W += (s['ìŠ¹ë¦¬']||0); t.L += (s['íŒ¨ë°°']||0); }
    });
    const rows = Object.entries(teams).map(([team,t])=>{
      const avg=t.AB? (t.H/t.AB).toFixed(3):'0.000';
      const era=t.IP? (t.ER*9/t.IP).toFixed(2):'0.00';
      const wr=(t.W+t.L)? ((t.W/(t.W+t.L))*100).toFixed(1)+'%':'-';
      return `<tr><td>${team}</td><td>${avg}</td><td>${era}</td><td>â€“</td><td>${t.RBI}</td><td>${wr}</td></tr>`;
    }).join('');
    teamTbody.innerHTML = rows || `<tr><td colspan="6" class="no-data">íŒ€ í†µê³„ ë°ì´í„° ì—†ìŒ</td></tr>`;
  }catch(err){
    console.error(err);
    mvpTbody.innerHTML=`<tr><td colspan="4" class="no-data">MVP ë¡œë”© ì‹¤íŒ¨</td></tr>`;
    teamTbody.innerHTML=`<tr><td colspan="6" class="no-data">íŒ€ í†µê³„ ë¡œë”© ì‹¤íŒ¨</td></tr>`;
  }
})();

/* ============= H2H (ê²€ìƒ‰/í‘œì‹œ) ============= */
const h2hPitcher=document.getElementById('h2hPitcher'), h2hHitter=document.getElementById('h2hHitter');
const dlPitchers=document.getElementById('dlPitchers'), dlHitters=document.getElementById('dlHitters');
const h2hGameSelect=document.getElementById('h2hGameSelect'), h2hSort=document.getElementById('h2hSort');
const h2hSearchBtn=document.getElementById('h2hSearchBtn'), h2hSummary=document.getElementById('h2hSummary');
const h2hTbody=document.querySelector('#h2hTable tbody'), h2hAggBody=document.querySelector('#h2hAggTable tbody');

function oText(e){
  const arr=[]; if(e.hitterEvent) arr.push(e.hitterEvent); if(e.rbi) arr.push(`RBI+${e.rbi}`); if(e.run) arr.push(`R+${e.run}`);
  if(e.pitcherEvent) arr.push(`P:${e.pitcherEvent}`); if(e.pitchCount) arr.push(`PC+${e.pitchCount}`); if(e.inningsDelta) arr.push(`IP+${e.inningsDelta}`); if(e.er) arr.push(`ER+${e.er}`);
  return arr.join(" Â· ");
}
(async function prepH2H(){
  const ps=await loadPlayers(); dlPitchers.innerHTML=ps.filter(p=>p.type==='íˆ¬ìˆ˜').map(p=>`<option value="${p.name}">`).join('');
  dlHitters.innerHTML=ps.filter(p=>p.type==='íƒ€ì').map(p=>`<option value="${p.name}">`).join('');
  const gr=await loadGameRecordMerged(); const gs=(gr.games||[]).map(normGame);
  h2hGameSelect.innerHTML='<option value="">ì „ì²´ ê²½ê¸°</option>'+gs.sort((a,b)=>(a.date||'').localeCompare(b.date||'')).map(g=>`<option value="${g.id}">${g.date} Â· ${g.away} @ ${g.home}</option>`).join('');
})();
function aggFrom(events){
  let PA=0,H=0,_2B=0,_3B=0,HR=0,BB=0,SO=0,RBI=0,R=0,AB=0,TB=0,SF=0;
  for(const e of events){ PA++;
    const t=(e.hitterEvent||'').trim();
    if(t==='1ë£¨íƒ€'){H++;AB++;TB+=1} else if(t==='2ë£¨íƒ€'){H++;_2B++;AB++;TB+=2}
    else if(t==='3ë£¨íƒ€'){H++;_3B++;AB++;TB+=3} else if(t==='í™ˆëŸ°'){H++;HR++;AB++;TB+=4}
    else if(t==='ë³¼ë„·'){BB++} else if(t==='í¬ìƒí”Œë¼ì´'){SF++} else if(t){AB++; if(t==='ì‚¼ì§„') SO++; }
    RBI += (e.rbi||0); R += (e.run||0);
  }
  const AVG=AB?H/AB:0; const OBPden=AB+BB+SF; const OBP=OBPden? (H+BB)/OBPden:0; const SLG=AB?TB/AB:0; const OPS=OBP+SLG;
  return {PA,H,_2B,_3B,HR,BB,SO,RBI,R,AVG,OBP,SLG,OPS};
}
h2hSearchBtn.onclick = async ()=>{
  const gr=await loadGameRecordMerged();
  const gamesMap={}; (gr.games||[]).map(normGame).forEach(g=>gamesMap[g.id]=g);
  const pitcher=h2hPitcher.value.trim(), hitter=h2hHitter.value.trim(); const gameFilter=h2hGameSelect.value||'';
  let evs=(gr.events||[]).map(normEvent).filter(e=>{
    const okP = pitcher ? e.pitcher===pitcher : true;
    const okH = hitter ? e.hitter===hitter : true;
    const okG = gameFilter ? (String(e.gameId)===String(gameFilter)) : true;
    return okP && okH && okG;
  });
  const sort=h2hSort.value;
  if(sort==='time_desc') evs.sort((a,b)=>(b.ts||0)-(a.ts||0));
  else if(sort==='time_asc') evs.sort((a,b)=>(a.ts||0)-(b.ts||0));
  else{ const r=h=>h==='ì´ˆ'?0:1; evs.sort((a,b)=>(a.inning-b.inning)||(r(a.half)-r(b.half))||((a.ts||0)-(b.ts||0))); }

  h2hTbody.innerHTML='';
  evs.forEach((e,i)=>{ const tr=document.createElement('tr');
    const timeCell = `<td class="compact">${fmtHHMM(e.ts)}</td>`;
    const gameCell = `<td class="compact">${gameIdToDate8(e, gamesMap)}</td>`;
    tr.innerHTML=`<td class="compact">${i+1}</td>${timeCell}${gameCell}<td>${e.inning}íšŒ ${e.half}</td><td>${e.offense}</td><td>${e.hitter}</td><td>${e.pitcher}</td><td>${oText(e)}</td>`;
    h2hTbody.appendChild(tr);
  });
  h2hSummary.textContent=`ì´ë²¤íŠ¸ ${evs.length}ê±´`;
  const a=aggFrom(evs);
  h2hAggBody.innerHTML=`<tr><td>${a.PA}</td><td>${a.H-a._2B-a._3B-a.HR}</td><td>${a._2B}</td><td>${a._3B}</td><td>${a.HR}</td><td>${a.BB}</td><td>${a.SO}</td><td>${a.RBI}</td><td>${a.R}</td><td>${a.AVG.toFixed(3)}</td><td>${a.OBP.toFixed(3)}</td><td>${a.SLG.toFixed(3)}</td><td>${a.OPS.toFixed(3)}</td></tr>`;
};

/* ============= GAMES : ì „ì²´ ê²½ê¸° ë¦¬ìŠ¤íŠ¸ ============= */
const gamesList = document.getElementById('gamesList');
const gamesEmpty = document.getElementById('gamesEmpty');

function abbrev(tag){
  switch(tag){
    case '1ë£¨íƒ€': return 'ì•ˆíƒ€';
    case '2ë£¨íƒ€': return '2ë£¨íƒ€';
    case '3ë£¨íƒ€': return '3ë£¨íƒ€';
    case 'í™ˆëŸ°':  return 'HR';
    case 'ë³¼ë„·':  return 'ë³¼ë„·';
    case 'ì‚¼ì§„':  return 'ì‚¼ì§„';
    case 'í¬ìƒí”Œë¼ì´': return 'SF';
    case 'ë‚´ì•¼ë•…ë³¼': return 'ë•…ë³¼';
    case 'í”Œë¼ì´ì•„ì›ƒ': return 'í”Œ';
    case 'ìˆ˜ë¹„ ì‹¤ì±…':  return 'E';          // â¬…ï¸ ì¶”ê°€: ì‹¤ì±…ë„ ë§¤íŠ¸ë¦­ìŠ¤/ì´ë²¤íŠ¸í‘œì— í‘œì‹œ
    default: return tag||'';
  }
}
function computeBox(events, away, home){
  const by={}; by[away]={R:0,H:0,E:0}; by[home]={R:0,H:0,E:0};
  for(const e of events){
    const t=e.offense; if(!(t in by)) by[t]={R:0,H:0,E:0};
    by[t].R += (e.run||0);
    const h=e.hitterEvent||'';
    if(h==='1ë£¨íƒ€'||h==='2ë£¨íƒ€'||h==='3ë£¨íƒ€'||h==='í™ˆëŸ°') by[t].H += 1;
    if(h==='ìˆ˜ë¹„ ì‹¤ì±…') by[t].E += 1; // íŒ€ ì‹¤ì±… ì¹´ìš´íŠ¸(ìˆìœ¼ë©´)
  }
  return by;
}
function makeTable(headers, rows){
  const t=document.createElement('table'); t.className='table';
  const thead=document.createElement('thead'), tbody=document.createElement('tbody');
  const hr=document.createElement('tr'); headers.forEach(h=>{ const th=document.createElement('th'); th.textContent=h; hr.appendChild(th); }); thead.appendChild(hr);
  rows.forEach(r=>{ const tr=document.createElement('tr'); tr.innerHTML=r.map(c=>`<td>${c}</td>`).join(''); tbody.appendChild(tr); });
  t.appendChild(thead); t.appendChild(tbody); return t;
}
function renderPAMatrix(events){
  const teamMap={};
  const maxInning = Math.max( ...events.map(e=>+e.inning||1), 9 );
  for(const e of events){
    const team=e.offense; const name=e.hitter;
    (teamMap[team] ||= {}); (teamMap[team][name] ||= {});
    const key=String(e.inning);
    const prev = teamMap[team][name][key] || '';
    const v = abbrev(e.hitterEvent);
    teamMap[team][name][key] = prev ? (prev+' / '+v) : v;
  }
  const wrap=document.createElement('div');
  Object.entries(teamMap).forEach(([team,rows])=>{
    const tbl=document.createElement('table'); tbl.className='table wide-table';
    const thead=document.createElement('thead'); const hdr=document.createElement('tr');
    hdr.innerHTML='<th>íƒ€ìëª…</th>'+Array.from({length:maxInning},(_,i)=>`<th>${i+1}</th>`).join(''); thead.appendChild(hdr);
    const tbody=document.createElement('tbody');
    Object.keys(rows).sort().forEach(name=>{
      const tr=document.createElement('tr'); let cells=`<td class="name">${name}</td>`;
      for(let i=1;i<=maxInning;i++) cells+=`<td>${rows[name][String(i)]||''}</td>`;
      tr.innerHTML=cells; tbody.appendChild(tr);
    });
    tbl.appendChild(thead); tbl.appendChild(tbody);

    const scroller=document.createElement('div'); scroller.className='scroll-x';
    scroller.appendChild(tbl);

    const head=document.createElement('div'); head.style="font-weight:900;margin:8px 0";
    head.textContent = `íŒ€: ${team}`;
    wrap.appendChild(head);
    wrap.appendChild(scroller);
  });
  return wrap;
}
function renderEventTable(events){
  const rows=events.map((e,i)=>[
    i+1, fmtTs(e.ts), `${e.inning}íšŒ ${e.half}`, e.offense, e.hitter, e.pitcher,
    [e.hitterEvent && abbrev(e.hitterEvent), e.rbi?`RBI+${e.rbi}`:'', e.run?`R+${e.run}`:'', e.pitcherEvent?`P:${e.pitcherEvent}`:''].filter(Boolean).join(' Â· ')
  ]);
  const scroller=document.createElement('div'); scroller.className='scroll-x';
  const table=makeTable(['#','ì‹œê°','ì´ë‹','ê³µê²©íŒ€','íƒ€ì','íˆ¬ìˆ˜','ê²°ê³¼'], rows);
  table.classList.add('wide-table');
  scroller.appendChild(table);
  return scroller;
}
(async function renderScheduleList(){
  const gr=await loadGameRecordMerged();
  const games=(gr.games||[]).map(normGame).sort((a,b)=>(b.date||'').localeCompare(a.date||''));
  const allE=(gr.events||[]).map(normEvent);
  gamesList.innerHTML='';
  if(!games.length){ gamesEmpty.hidden=false; return; }
  gamesEmpty.hidden=true;

  games.forEach(g=>{
    const evs = allE.filter(e=>String(e.gameId)===String(g.id));
    const box = computeBox(evs, g.away, g.home);

    const card=document.createElement('div'); card.className='game-card';

    const head=document.createElement('div'); head.className='game-head';
    const title=document.createElement('div'); title.className='game-title'; title.textContent = `${g.date} Â· ${g.away} @ ${g.home}`;
    const score=document.createElement('div'); score.className='score-pill';
    const awayR = (box[g.away]?.R)||0, homeR=(box[g.home]?.R)||0;
    score.textContent = `${g.away} ${awayR} â€” ${homeR} ${g.home}`;
    head.appendChild(title); head.appendChild(score);
    card.appendChild(head);

    const rows = [
      [g.home, box[g.home]?.R||0, box[g.home]?.H||0, box[g.home]?.E||0],
      [g.away, box[g.away]?.R||0, box[g.away]?.H||0, box[g.away]?.E||0],
    ];
    card.appendChild( makeTable(['Team','R','H','E'], rows) );

    const paDet=document.createElement('details'); paDet.className='disclosure';
    paDet.innerHTML = `<summary>íƒ€ì„ ë§¤íŠ¸ë¦­ìŠ¤ (ì´ë‹ë³„/íƒ€ì) <span class="sub">í¼ì¹˜ê¸°</span></summary>`;
    paDet.appendChild( renderPAMatrix(evs) );
    card.appendChild(paDet);

    const evDet=document.createElement('details'); evDet.className='disclosure';
    evDet.innerHTML = `<summary>ì´ë²¤íŠ¸ ${evs.length}ê±´ <span class="sub">í¼ì¹˜ê¸°</span></summary>`;
    evDet.appendChild( renderEventTable(evs) );
    card.appendChild(evDet);

    gamesList.appendChild(card);
  });
})();
  // === í†µê³„ ë©”ë‰´ ê·¸ë£¹ ì¹© í™œì„±í™” ì œì–´ ===
  const chipHit = document.getElementById('chipHit');
  const chipPit = document.getElementById('chipPit');
  function setGroupActive(which){          // 'hit' | 'pit' | null
    chipHit.classList.toggle('active', which==='hit');
    chipPit.classList.toggle('active', which==='pit');
  }

  // ê¸°ì¡´ ë©”ë‰´ í•¸ë“¤ëŸ¬ì— ê·¸ë£¹ í™œì„±í™”ë§Œ ì¶”ê°€
  hitterMenu.onclick = async (e)=>{
    if(e.target?.dataset?.stat){
      setGroupActive('hit');
      searchInput.value=''; // ë©”ë‰´ í´ë¦­ ì‹œ ê²€ìƒ‰ ì´ˆê¸°í™”(ì„ íƒ)
      [...hitterMenu.children, ...pitcherMenu.children].forEach(x=>x.classList.remove('active'));
      e.target.classList.add('active');
      renderRanking(e.target.dataset.stat, ['ERA','WHIP'].includes(e.target.dataset.stat));
    }
  };
  pitcherMenu.onclick = async (e)=>{
    if(e.target?.dataset?.stat){
      setGroupActive('pit');
      searchInput.value='';
      [...hitterMenu.children, ...pitcherMenu.children].forEach(x=>x.classList.remove('active'));
      e.target.classList.add('active');
      renderRanking(e.target.dataset.stat, ['ERA','WHIP'].includes(e.target.dataset.stat));
    }
  };

  // ê²€ìƒ‰ ì…ë ¥ ì‹œ ë‘ ê·¸ë£¹ ì¹© ë¹„í™œì„±í™” + ë©”ë‰´ í™œì„±í™” í•´ì œ
  searchInput.addEventListener('input', ()=>{
    if(searchInput.value.trim()){
      setGroupActive(null);
      [...hitterMenu.children, ...pitcherMenu.children].forEach(x=>x.classList.remove('active'));
      renderBySearch();
    }else{
      document.getElementById('rankingContent').innerHTML =
        '<div class="no-data">ì´ë¦„ì„ ì…ë ¥í•˜ê±°ë‚˜, ìœ„ì—ì„œ ë¶„ì•¼ë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>';
    }
  });

  // ì¹©(í…ìŠ¤íŠ¸) í´ë¦­ ì‹œì—” ë™ì‘ ì—†ìŒ(ì¥ì‹), í•„ìš”í•˜ë©´ ìŠ¤í¬ë¡¤ í¬ì»¤ì‹± ì •ë„ë§Œ:
  chipHit.onclick = ()=> window.scrollBy({top:1, behavior:'smooth'});
  chipPit.onclick = ()=> window.scrollBy({top:1, behavior:'smooth'});

const GAS_URL = "https://docs.google.com/spreadsheets/d/11bOxFo__bQOWE3L6lFp3mZ3-TNonPYrP5cKErY-p-k8/edit?usp=drivesdk"; // Google Apps Script ì›¹ ì•± URL

function getVoterId(){
  let id = localStorage.getItem('mvp_voter_id');
  if(!id){
    id = crypto.getRandomValues(new Uint32Array(4)).join('-');
    localStorage.setItem('mvp_voter_id', id);
  }
  return id;
}
function votedKey(){ return 'mvp_voted_' + new Date().toISOString().slice(0,10); }

async function sendVote(player, team){
  if(localStorage.getItem(votedKey())){ alert('ì˜¤ëŠ˜ ì´ë¯¸ íˆ¬í‘œí–ˆìŠµë‹ˆë‹¤!'); return; }
  const res = await fetch(GAS_URL, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({
      player, team,
      voterId: getVoterId(),
      ua: navigator.userAgent.slice(0,120)
    })
  });
  if(res.ok){
    localStorage.setItem(votedKey(), '1');
    alert('íˆ¬í‘œ ì™„ë£Œ!');
    await refreshVoteCounts();
  } else {
    alert('íˆ¬í‘œ ì˜¤ë¥˜');
  }
}

async function fetchVoteCounts(){
  try{
    const res = await fetch(GAS_URL, { method:'GET' });
    if(!res.ok) return {};
    return await res.json();
  }catch(e){ return {}; }
}
async function refreshVoteCounts(){
  const counts = await fetchVoteCounts();
  const ul=document.getElementById('mvpVoteResults');
  ul.innerHTML='';
  Object.entries(counts).forEach(([name,cnt])=>{
    const li=document.createElement('li');
    li.textContent=`${name}: ${cnt}í‘œ`;
    ul.appendChild(li);
  });
}
window.addEventListener('load', refreshVoteCounts);
</script>
</body>
</html>

