<!DOCTYPE html>

<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>선수 기록 조회 및 분야별 순위</title>
  <style>
   body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px 30px;
      background-color: #f9faff;
      color: #333;
      overflow-x: auto;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px 30px;
      background-color: #f9faff;
      color: #333;
    }
    h1 {
      font-weight: 700;
      font-size: 2rem;
      margin-bottom: 20px;
      color: #1a73e8;
      text-align: center;
    }
    button#goToInputBtn {
      background-color: #1a73e8;
      color: white;
      font-weight: 600;
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-bottom: 20px;
      display: inline-block;
    }
    button#goToInputBtn:hover {
      background-color: #155ab6;
    }
    #searchInput {
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 6px;
      border: 1.5px solid #ccc;
      font-size: 1rem;
    }
    .container {
      display: flex;
      gap: 30px;
      min-height: 350px;
      flex-wrap: wrap;
    }
    nav.menu {
      width: 180px;
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgb(26 115 232 / 0.15);
      overflow-y: auto;
      padding: 10px 0;
      flex-shrink: 0;
    }
    nav.menu h2 {
      font-weight: 700;
      font-size: 1.2rem;
      color: #1a73e8;
      padding: 8px 16px;
      border-bottom: 1px solid #eee;
      margin-bottom: 10px;
    }
    nav.menu ul {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }
    nav.menu li {
      padding: 10px 16px;
      cursor: pointer;
      transition: background-color 0.3s ease, color 0.3s ease;
      font-weight: 600;
      font-size: 0.95rem;
    }
    nav.menu li:hover {
      background-color: #cde0fe;
      color: #1a73e8;
    }
    nav.menu li.active {
      background-color: #1a73e8;
      color: white;
    }
    section.content {
      flex: 1 1 600px;
      background-color: white;
      border-radius: 8px;
      border: 1px solid #ddd;
      box-shadow: 0 2px 8px rgb(26 115 232 / 0.15);
      padding: 20px;
      overflow-x: auto;
      min-width: 300px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      min-width: 500px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px 12px;
      text-align: center;
      font-size: 0.95rem;
      white-space: nowrap;
    }
    th {
      background-color: #e8f0fe;
      color: #1a73e8;
      font-weight: 700;
      user-select: none;
    }
    p.no-data {
      font-size: 1.1rem;
      color: #666;
      text-align: center;
      margin-top: 40px;
    }
    /* 선수 이름 링크 스타일 */
    td.player-name {
      color: #1a73e8;
      cursor: pointer;
      text-decoration: underline;
    }

    /* 최근 MVP 표시 섹션 */
    #recentMvpSection {
      position: relative;
      width: 600px;
      height: 140px;
      margin: 0 auto 20px auto;
      background-color: #1b3764;
      border-radius: 15px;
      box-shadow:
        0 0 10px #123663,
        inset 0 0 20px #2e5ba6;
      display: flex;
      align-items: center;
      padding: 0 30px 0 90px; /* 왼쪽 별 공간 위해 padding-left 넉넉히 */
      overflow: hidden;
      user-select: none;
    }
    #recentMvpSection::before {
      content: "★";
      position: absolute;
      left: 30px;
      font-size: 6rem;
      color: #17438a;
      opacity: 0.3;
      filter: drop-shadow(0 0 4px #0f2a55);
      animation: starGlow 3s infinite ease-in-out;
      z-index: 1;
      user-select: none;
    }
    @keyframes starGlow {
      0%, 100% { opacity: 0.3; filter: drop-shadow(0 0 4px #0f2a55); }
      50% { opacity: 1; filter: drop-shadow(0 0 15px #4aa0ff); }
    }

    /* MVP 텍스트 스타일 및 애니메이션 */
    #mvpText {
      font-weight: 900;
      font-size: 4.5rem;
      color: #8a160e;
      text-shadow:
        0 0 12px #d64a4a,
        0 0 25px #d64a4a,
        0 0 30px #8a160e,
        0 0 40px #8a160e;
      margin-right: 20px;
      animation: mvpPulse 2.5s ease-in-out infinite alternate;
      z-index: 10;
      user-select: none;
      white-space: nowrap;
    }
    @keyframes mvpPulse {
      0% {
        transform: scale(1) rotate(0deg);
        text-shadow:
          0 0 12px #d64a4a,
          0 0 25px #d64a4a,
          0 0 30px #8a160e,
          0 0 40px #8a160e;
        color: #8a160e;
      }
      50% {
        transform: scale(1.1) rotate(-5deg);
        text-shadow:
          0 0 20px #ff7070,
          0 0 35px #ff7070,
          0 0 50px #bf1e1e,
          0 0 60px #bf1e1e;
        color: #bf1e1e;
      }
      100% {
        transform: scale(1) rotate(0deg);
        text-shadow:
          0 0 12px #d64a4a,
          0 0 25px #d64a4a,
          0 0 30px #8a160e,
          0 0 40px #8a160e;
        color: #8a160e;
      }
    }

    /* SPORTS 글씨 스타일 */
    #sportsBadge {
      font-size: 1.1rem;
      font-weight: 600;
      background: #8a160e;
      color: white;
      border-radius: 12px;
      padding: 3px 10px;
      margin-left: 8px;
      vertical-align: middle;
      user-select: none;
      white-space: nowrap;
      box-shadow:
        0 0 10px #d64a4a;
      animation: sportsGlow 2.5s ease-in-out infinite alternate;
      cursor: default;
    }
    @keyframes sportsGlow {
      0% {
        box-shadow:
          0 0 10px #d64a4a;
        background: #8a160e;
      }
      50% {
        box-shadow:
          0 0 20px #ff7070;
        background: #bf1e1e;
      }
      100% {
        box-shadow:
          0 0 10px #d64a4a;
        background: #8a160e;
      }
    }

    /* 선수 이름 스타일 및 애니메이션 */
    #playerName {
      font-weight: 900;
      font-size: 3.3rem;
      color: #8a160e;
      margin-left: 20px;
      text-shadow:
        0 0 10px #d64a4a,
        0 0 20px #bf1e1e;
      animation: nameGlow 3s ease-in-out infinite alternate;
      user-select: none;
      white-space: nowrap;
      overflow: visible;
    }
    @keyframes nameGlow {
      0% {
        color: #8a160e;
        text-shadow:
          0 0 10px #d64a4a,
          0 0 20px #bf1e1e;
      }
      50% {
        color: #bf1e1e;
        text-shadow:
          0 0 20px #ff7070,
          0 0 30px #d64a4a,
          0 0 40px #bf1e1e;
      }
      100% {
        color: #8a160e;
        text-shadow:
          0 0 10px #d64a4a,
          0 0 20px #bf1e1e;
      }
    }

    /* 선수 정보 스타일 (팀/타자or투수) */
    #playerInfo {
      font-size: 1.2rem;
      font-weight: 600;
      color: #eee;
      margin-left: 25px;
      user-select: none;
      text-shadow: 0 0 10px #222;
      white-space: nowrap;
      align-self: flex-end;
    }

    /* 나머지 섹션 스타일 유지 */
    #mvpRankingSection, #teamStatsSection {
      background: #f0f4ff;
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      box-shadow: 0 2px 8px rgb(26 115 232 / 0.15);
    }
    #mvpRankingSection h3, #teamStatsSection h3 {
      color: #1a73e8;
      margin-bottom: 15px;
      font-weight: 700;
    }
  </style>
</head>
<body>

  <h1>선수 기록 조회 및 분야별 순위</h1>

  <div id="recentMvpSection">
    <div id="mvpText">
      MVP
      <span id="sportsBadge">SPORTS</span>
    </div>
    <div id="playerName">Name</div>
    <div id="playerInfo">(Team / Position)</div>
  </div>

  <button id="goToInputBtn">기록 입력 페이지로 이동</button>

  <input type="text" id="searchInput" placeholder="선수 이름 검색" autocomplete="off" />

  <div class="container">
    <nav class="menu">
      <h2>타자 분야</h2>
      <ul id="hitterMenu">
        <li data-stat="타율">타율</li>
        <li data-stat="홈런">홈런</li>
        <li data-stat="출루율">출루율</li>
        <li data-stat="OPS">OPS</li>
        <li data-stat="타점">타점</li>
      </ul>
      <h2>투수 분야</h2>
      <ul id="pitcherMenu">
        <li data-stat="승리">승리</li>
        <li data-stat="세이브">세이브</li>
        <li data-stat="홀드">홀드</li>
        <li data-stat="삼진">삼진</li>
        <li data-stat="ERA">ERA</li>
        <li data-stat="WHIP">WHIP</li>
      </ul>
    </nav>

    <section class="content" id="rankingContent">
      <p class="no-data">분야를 선택하세요.</p>
    </section>
  </div>

  <div id="mvpRankingSection" style="display:none;">
    <h3>MVP 순위</h3>
    <table id="mvpRankingTable">
      <thead>
        <tr>
          <th>순위</th>
          <th>선수명</th>
          <th>팀</th>
          <th>MVP 횟수</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="teamStatsSection" style="display:none;">
    <h3>팀별 주요 통계</h3>
    <table id="teamStatsTable">
      <thead>
        <tr>
          <th>팀명</th>
          <th>팀 타율</th>
          <th>팀 자책점</th>
          <th>팀 득점</th>
          <th>팀 타점</th>
          <th>팀 승률</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
  const PLAYER_JSON_URL = "https://alex4u-jun.github.io/bs_record/players.json";

  // fetch로 players.json을 불러오는 함수
  async function loadPlayersFromJson() {
    try {
      const res = await fetch(PLAYER_JSON_URL);
      if (!res.ok) throw new Error("선수 데이터를 불러오는 데 실패했습니다.");
      return await res.json();
    } catch (err) {
      console.error("fetch 실패:", err);
      return [];
    }
  }

  const goToInputBtn = document.getElementById('goToInputBtn');
  const hitterMenu = document.getElementById('hitterMenu');
  const pitcherMenu = document.getElementById('pitcherMenu');
  const rankingContent = document.getElementById('rankingContent');
  const searchInput = document.getElementById('searchInput');
  const mvpText = document.getElementById('mvpText');
  const playerName = document.getElementById('playerName');
  const playerInfo = document.getElementById('playerInfo');
  const mvpRankingSection = document.getElementById('mvpRankingSection');
  const mvpRankingTableBody = document.querySelector('#mvpRankingTable tbody');
  const teamStatsSection = document.getElementById('teamStatsSection');
  const teamStatsTableBody = document.querySelector('#teamStatsTable tbody');
  const hitterStatsForRanking = ['타율', '홈런', '출루율', 'OPS', '타점'];
  const pitcherStatsForRanking = ['승리', '세이브', '홀드', '삼진', 'ERA', 'WHIP'];
  let currentSort = { column: null, asc: true };

  function loadRecentMvp() {
    const mvpData = localStorage.getItem('lastMvp');
    if (mvpData) {
      const mvp = JSON.parse(mvpData);
      mvpText.innerHTML = 'MVP <span id="sportsBadge">SPORTS</span>';
      playerName.textContent = mvp.name;
      playerInfo.textContent = `(${mvp.team} / ${mvp.type})`;
    }
  }

  function filterByName(players, keyword) {
    if (!keyword) return players;
    const lower = keyword.toLowerCase();
    return players.filter(p => p.name.toLowerCase().includes(lower));
  }

  function calculateAVG(p) {
    const H = (p.stats['1루타']||0) + (p.stats['2루타']||0) + (p.stats['3루타']||0) + (p.stats['홈런']||0);
    const AB = H + (p.stats['삼진']||0) + (p.stats['내야땅볼']||0) + (p.stats['플라이아웃']||0);
    return AB ? H / AB : 0;
  }

  function calculateOBP(p) {
    const H = (p.stats['1루타']||0) + (p.stats['2루타']||0) + (p.stats['3루타']||0) + (p.stats['홈런']||0);
    const BB = p.stats['볼넷']||0;
    const AB = H + (p.stats['삼진']||0) + (p.stats['내야땅볼']||0) + (p.stats['플라이아웃']||0);
    const SF = p.stats['희생플라이']||0;
    const denom = AB + BB + SF;
    return denom ? (H + BB) / denom : 0;
  }

  function calculateSLG(p) {
    const doubles = p.stats['2루타']||0, triples = p.stats['3루타']||0, HR = p.stats['홈런']||0;
    const AB = doubles + triples + HR + (p.stats['삼진']||0) + (p.stats['내야땅볼']||0) + (p.stats['플라이아웃']||0);
    const TB = doubles*2 + triples*3 + HR*4;
    return AB ? TB / AB : 0;
  }

  function calculateOPS(p) {
    return calculateOBP(p) + calculateSLG(p);
  }

  function calculateERA(p) {
    const ER = p.stats['자책점']||0, IP = p.stats['이닝']||0;
    return IP ? (ER * 9) / IP : 0;
  }

  function calculateWHIP(p) {
    const BB = p.stats['볼넷']||0, H = p.stats['피안타']||0, IP = p.stats['이닝']||0;
    return IP ? (BB + H) / IP : 0;
  }

  function getStatValue(p, stat) {
    switch(stat) {
      case '타율': return calculateAVG(p);
      case '출루율': return calculateOBP(p);
      case 'OPS': return calculateOPS(p);
      case '홈런': case '타점': case '승리':
      case '세이브': case '홀드': case '삼진':
        return p.stats[stat] || 0;
      case 'ERA': return calculateERA(p);
      case 'WHIP': return calculateWHIP(p);
      default: return 0;
    }
  }

  function getStatDisplay(p, stat) {
    const val = getStatValue(p, stat);
    if (['타율', '출루율', 'OPS', 'WHIP'].includes(stat)) return val.toFixed(3);
    if (stat === 'ERA') return val.toFixed(2);
    return val;
  }

  function createRankingTable(players, stat) {
    const table = document.createElement('table');
    const thead = document.createElement('thead');
    const tbody = document.createElement('tbody');

    const headerRow = document.createElement('tr');
    ['순위', '선수명', stat].forEach((t, i) => {
      const th = document.createElement('th');
      th.textContent = t;
      if (i === 2) {
        th.style.cursor = 'pointer';
        th.addEventListener('click', () => {
          currentSort.column = stat;
          currentSort.asc = !currentSort.asc;
          renderRanking(stat, currentSort.asc);
        });
        th.textContent += currentSort.asc ? ' ▲' : ' ▼';
      }
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);

    players.forEach((p, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${i+1}</td>
        <td class="player-name" style="cursor:pointer;color:#1a73e8;text-decoration:underline">${p.name}</td>
        <td>${getStatDisplay(p, stat)}</td>
      `;
      tr.querySelector('.player-name').onclick = () => {
        window.location.href = `player_detail.html?name=${encodeURIComponent(p.name)}&type=${encodeURIComponent(p.type)}`;
      };
      tbody.appendChild(tr);
    });

    table.appendChild(thead);
    table.appendChild(tbody);
    return table;
  }

  async function renderRanking(stat, asc = true) {
    rankingContent.innerHTML = '';
    let players = await loadPlayersFromJson();
    players = (hitterStatsForRanking.includes(stat))
      ? players.filter(p => p.type === '타자')
      : players.filter(p => p.type === '투수');
    const keyword = searchInput.value.trim();
    players = filterByName(players, keyword);
    players.sort((a, b) => asc ? getStatValue(a, stat) - getStatValue(b, stat) : getStatValue(b, stat) - getStatValue(a, stat));
    rankingContent.appendChild(createRankingTable(players, stat));
  }

  async function renderMvpRanking() {
    const players = (await loadPlayersFromJson()).filter(p => p.mvpCount > 0);
    if (!players.length) return mvpRankingSection.style.display = 'none';
    mvpRankingSection.style.display = 'block';

    const mvpMap = {};
    players.forEach(p => {
      if (!mvpMap[p.name]) mvpMap[p.name] = { ...p, teams: [p.team], types: [p.type] };
      else {
        mvpMap[p.name].mvpCount += p.mvpCount;
        if (!mvpMap[p.name].teams.includes(p.team)) mvpMap[p.name].teams.push(p.team);
      }
    });

    const list = Object.values(mvpMap).sort((a,b) => b.mvpCount - a.mvpCount);
    mvpRankingTableBody.innerHTML = '';
    list.forEach((p, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${i+1}</td><td class="player-name" style="cursor:pointer;color:#1a73e8;text-decoration:underline">${p.name}</td><td>${p.teams.join(', ')}</td><td>${p.mvpCount}</td>`;
      tr.querySelector('.player-name').onclick = () => {
        window.location.href = `player_detail.html?name=${encodeURIComponent(p.name)}&type=${encodeURIComponent(p.types[0])}`;
      };
      mvpRankingTableBody.appendChild(tr);
    });
  }

  async function calculateTeamStats() {
    const players = await loadPlayersFromJson();
    const teams = {};
    players.forEach(p => {
      const t = teams[p.team] ||= {
        totalHits: 0, totalAtBats: 0, totalER: 0, totalInnings: 0,
        totalRuns: 0, totalRBI: 0, totalWins: 0, totalLosses: 0
      };
      if (p.type === '타자') {
        const H = (p.stats['1루타']||0)+(p.stats['2루타']||0)+(p.stats['3루타']||0)+(p.stats['홈런']||0);
        const AB = H + (p.stats['삼진']||0)+(p.stats['내야땅볼']||0)+(p.stats['플라이아웃']||0);
        t.totalHits += H;
        t.totalAtBats += AB;
        t.totalRBI += p.stats['타점'] || 0;
      }
      if (p.type === '투수') {
        t.totalER += p.stats['자책점']||0;
        t.totalInnings += p.stats['이닝']||0;
        t.totalWins += p.stats['승리']||0;
        t.totalLosses += p.stats['패배']||0;
      }
    });

    teamStatsTableBody.innerHTML = '';
    for (const [team, t] of Object.entries(teams)) {
      const avg = t.totalAtBats ? t.totalHits / t.totalAtBats : 0;
      const era = t.totalInnings ? (t.totalER * 9 / t.totalInnings) : 0;
      const winRate = (t.totalWins + t.totalLosses) ? t.totalWins / (t.totalWins + t.totalLosses) : 0;
      teamStatsTableBody.innerHTML += `
        <tr>
          <td>${team}</td>
          <td>${avg.toFixed(3)}</td>
          <td>${era.toFixed(2)}</td>
          <td>–</td>
          <td>${t.totalRBI}</td>
          <td>${(winRate*100).toFixed(1)}%</td>
        </tr>
      `;
    }
    teamStatsSection.style.display = 'block';
  }

  document.addEventListener('DOMContentLoaded', async () => {
    loadRecentMvp();
    await renderMvpRanking();
    await calculateTeamStats();
  });

  goToInputBtn.onclick = () => {
    const pw = prompt("기록 입력 페이지 접근을 위한 암호를 입력하세요.");
    if (pw === "Leaders0903") location.href = "index.html";
    else alert("암호가 틀렸습니다.");
  };

  function clearActiveMenu() {
    [...hitterMenu.children, ...pitcherMenu.children].forEach(li => li.classList.remove('active'));
  }

  hitterMenu.onclick = e => {
    if (e.target.tagName === 'LI') {
      clearActiveMenu();
      e.target.classList.add('active');
      currentSort.column = e.target.dataset.stat;
      currentSort.asc = true;
      searchInput.value = '';
      renderRanking(currentSort.column, currentSort.asc);
    }
  };

  pitcherMenu.onclick = e => {
    if (e.target.tagName === 'LI') {
      clearActiveMenu();
      e.target.classList.add('active');
      currentSort.column = e.target.dataset.stat;
      currentSort.asc = true;
      searchInput.value = '';
      renderRanking(currentSort.column, currentSort.asc);
    }
  };

  searchInput.oninput = () => {
    if (currentSort.column) renderRanking(currentSort.column, currentSort.asc);
  };
</script>

</body>
</html>



