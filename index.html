<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì•¼êµ¬ ê¸°ë¡ ì…ë ¥</title>
  <style>
/* ======================= í…Œë§ˆ (ë¼ì´íŠ¸/ë‹¤í¬) ======================= */
:root{
  --bg:#f9faff;
  --text:#333;
  --muted:#5f6368;
  --card:#ffffff;
  --border:#dde2f1;
  --brand:#1a73e8;
  --pill-bg:#e8f0fe;
  --pill-text:#1a73e8;
  --thead:#eef3ff;
  --theadText:#1a73e8;

  --chip-bg:#fff;
  --chip-bd:#bcd0ff;
  --chip-sel:#1a73e8;
  --chip-wrap:#eef4ff;
}
[data-theme="dark"]{
  --bg:#0f172a;
  --text:#e5e7eb;
  --muted:#a3acc2;
  --card:#0b1220;
  --border:#22314d;
  --brand:#86b7ff;
  --pill-bg:#13213a;
  --pill-text:#cfe2ff;
  --thead:#15223c;
  --theadText:#cfe2ff;

  --chip-bg:#0f1a33;
  --chip-bd:#314a80;
  --chip-sel:#86b7ff;
  --chip-wrap:#0f1a33;
}

/* ======================= ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ======================= */
body {
  font-family: Arial, sans-serif;
  max-width: 1200px;
  margin: 40px auto;
  padding: 20px 30px;
  background-color: var(--bg);
  color: var(--text);
  overflow-x: auto;
}
h1 {
  font-size: 2rem;
  font-weight: 700;
  color: var(--brand);
  margin-bottom: 18px;
  text-align: center;
}
nav a {
  display: inline-block;
  padding: 10px 20px;
  margin-bottom: 18px;
  background-color: var(--brand);
  color: white;
  font-weight: 600;
  border-radius: 6px;
  text-decoration: none;
  transition: filter .2s ease;
}
nav a:hover { filter: brightness(.92); }

/* ë‹¤í¬ëª¨ë“œ í† ê¸€ */
#themeToggle{
  float:right;
  margin-top:-6px;
  margin-bottom:8px;
  padding:6px 10px;
  border-radius:6px;
  border:1px solid var(--border);
  background:var(--card);
  color:var(--text);
  cursor:pointer;
}

/* ê³µí†µ ë²„íŠ¼ */
button {
  padding: 10px 20px;
  font-size: 1rem;
  font-weight: 600;
  border: none;
  border-radius: 6px;
  background-color: var(--brand);
  color: white;
  cursor: pointer;
  transition: filter .2s ease;
  white-space: nowrap;
}
button:hover { filter: brightness(.92); }

form {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-bottom: 16px;
  flex-wrap: wrap;
}
input[type="text"], select {
  padding: 10px 12px;
  font-size: 1rem;
  border: 1.5px solid var(--border);
  border-radius: 6px;
  width: 180px;
  min-width: 150px;
  background: var(--card);
  color: var(--text);
}
input[type="text"]:focus, select:focus { outline: 2px solid var(--brand); }

/* ì¹´ë“œ ì„¹ì…˜ */
.section {
  background-color: var(--card);
  padding: 20px 25px;
  border-radius: 10px;
  border:1px solid var(--border);
  box-shadow: 0 4px 14px rgba(26,115,232,.08);
  overflow-x: auto;
  margin-top: 18px;
}

/* ìƒë‹¨ ì œì–´ë°” */
.controlbar{
  display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-bottom:10px;
}
.left-controls, .right-controls{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
.pill{
  background:var(--pill-bg); color:var(--pill-text); padding:6px 12px; border-radius:999px; font-weight:700;
}

/* ë¼ì¸ì—… 2ì—´ */
.lineup-2col{
  display:grid; gap:16px;
  grid-template-columns: 1fr 1fr;
}
.lineup-card{
  border:1px solid var(--border); border-radius:10px; padding:14px; background:var(--card);
}
.lineup-title{ font-weight:800; color:var(--brand); margin-bottom:8px; }
.lineup-table{ width:100%; border-collapse:collapse; min-width:420px; }
.lineup-table th, .lineup-table td{
  border:1px solid var(--border); padding:6px 8px; text-align:center; background:transparent; color:var(--text);
}
.lineup-table th{ background:var(--thead); color:var(--theadText); }

/* ë“€ì–¼ ê·¸ë¦¬ë“œ(íˆ¬ìˆ˜/íƒ€ì ì…ë ¥) */
.duel-grid{ display:flex; gap:30px; flex-wrap:wrap; }
#pitcherSearch, #hitterSearch{
  width: 100%; margin-bottom: 12px; padding: 10px 12px;
  border-radius:6px; border:1.5px solid var(--border);
  background:var(--card); color:var(--text);
}
#pitcherSearchResults div, #hitterSearchResults div{
  padding:6px 8px; margin-bottom:6px; background-color:var(--thead); border-radius:4px; cursor:pointer;
}
#pitcherEditSection, #hitterEditSection{
  background: var(--chip-wrap);
  border: 1px solid var(--border);
  padding: 15px 20px;
  border-radius: 8px;
  margin-top: 8px;
}
#pitcherNameDisplay, #hitterNameDisplay{ font-weight:700; color:var(--brand); margin-bottom:10px; }

/* ì¹©(ë‹¨ì¼ì„ íƒ) */
.group-title{ font-weight:700; color:var(--text); margin:8px 0 6px; }
.chip-group{
  display:flex; flex-wrap:wrap; gap:8px; background:var(--chip-wrap);
  border:1px solid var(--border); border-radius:10px; padding:10px;
}
.chip{
  padding:8px 12px; border-radius:8px; border:1px solid var(--chip-bd); background:var(--chip-bg);
  cursor:pointer; user-select:none; transition:.15s ease;
}
.chip.selected{
  background:var(--chip-sel); color:#fff; border-color:var(--chip-sel);
  box-shadow:0 2px 8px rgba(26,115,232,.25);
}

/* ìˆ«ì ì…ë ¥ + í° í™”ì‚´í‘œ(ì»¤ìŠ¤í…€ ìŠ¤í”¼ë„ˆ) */
.num-row{ display:flex; align-items:center; gap:10px; margin:8px 0; }
.num-row label{ min-width:90px; font-weight:600; color:var(--text); }
.spin-wrap{ display:flex; align-items:center; gap:6px; }
.spin-input{
  width:120px; padding:10px 12px; border:1.5px solid var(--border);
  border-radius:8px; font-size:1rem; background:var(--card); color:var(--text);
}
.spin-btn{
  width:38px; height:38px; font-size:18px; font-weight:800; line-height:1;
  border-radius:8px; border:1px solid var(--border); background:var(--thead); color:var(--text);
  cursor:pointer;
}
.spin-btn:active{ transform: translateY(1px); }

/* í…Œì´ë¸”/ë¦¬ìŠ¤íŠ¸ */
.player-list > div {
  background-color: var(--card);
  border: 1px solid var(--border);
  padding: 16px 20px;
  border-radius: 8px;
  margin-bottom: 20px;
  box-shadow: 0 2px 6px rgb(26 115 232 / 0.12);
  overflow-x: auto;
  max-width: 100%;
}
.player-list h3 {
  font-weight: 700;
  color: var(--brand);
  margin-bottom: 15px;
  display: flex; justify-content: space-between; align-items: center;
}
.delete-btn {
  color: #e53935; font-size: 14px; padding: 4px 8px; border-radius: 4px;
  background: none; border: none; cursor: pointer;
}
table { width: 100%; border-collapse: collapse; margin-top: 10px; min-width: 900px; }
th, td { border: 1px solid var(--border); text-align: center; font-size: 0.9rem; white-space: nowrap; padding: 8px 6px; }
th { background: var(--thead); color: var(--theadText); font-weight: 700; user-select: none; }
td.buttons-cell{ padding:4px 6px; }
button.stat-btn{
  width:24px; height:24px; font-size:16px; line-height:1; padding:0; border-radius:4px;
  border:1px solid var(--border); background:var(--thead); cursor:pointer; margin:0 2px;
}
.muted{ color:var(--muted); font-size:0.92rem; }
  </style>
</head>
<body>
  <h1>ì„ ìˆ˜ ê¸°ë¡ ì…ë ¥ ë° ê´€ë¦¬</h1>
  <button id="themeToggle">ğŸŒ™ ë‹¤í¬ ëª¨ë“œ</button>
  <nav>
    <a href="records.html">ì„ ìˆ˜ ê¸°ë¡ ì¡°íšŒ í˜ì´ì§€ë¡œ ì´ë™</a>
  </nav>

  <!-- ì„ ìˆ˜ ì¶”ê°€ -->
  <form id="addPlayerForm">
    <input type="text" id="playerName" placeholder="ì„ ìˆ˜ ì´ë¦„" required />
    <select id="playerType">
      <option value="íƒ€ì">íƒ€ì</option>
      <option value="íˆ¬ìˆ˜">íˆ¬ìˆ˜</option>
    </select>
    <select id="playerTeam" required>
      <option value="" disabled selected>íŒ€ ì„ íƒ</option>
      <option value="Leaders">Leaders</option>
      <option value="CSIA">CSIA</option>
    </select>
    <button type="submit">ì„ ìˆ˜ ì¶”ê°€</button>
  </form>

  <!-- === íˆ¬íƒ€ ëŒ€ê²° + ë¼ì¸ì—… + ì´ë‹ === -->
  <section class="section" id="duelSection">
    <!-- ìƒë‹¨ ì»¨íŠ¸ë¡¤ë°” -->
    <div class="controlbar">
      <div class="left-controls">
        <span class="pill" id="inningBadge">1íšŒ ì´ˆ Â· ê³µê²©: Leaders</span>
        <span class="pill" id="historyBadge">íˆìŠ¤í† ë¦¬ 0ê±´ Â· í¬ì¸í„° ìµœì‹ </span>
      </div>
      <div class="right-controls">
        <label for="firstTeamSel" class="muted">ì„ ê³µ íŒ€:</label>
        <select id="firstTeamSel">
          <option value="Leaders">Leaders</option>
          <option value="CSIA">CSIA</option>
        </select>
        <button id="applyFirstTeamBtn" style="background:#34a853;">ì„ ê³µ ì ìš©</button>
        <button id="resetInningBtn" style="background:#e67e22;">ì´ë‹ ì´ˆê¸°í™”</button>
      </div>
    </div>

    <!-- ë¼ì¸ì—…: ì–‘ìª½ ë™ì‹œ í‘œì‹œ -->
    <div class="lineup-2col" style="margin-bottom:12px;">
      <div class="lineup-card">
        <div class="lineup-title">Leaders ë¼ì¸ì—…</div>
        <div id="lineupEditorLeaders"></div>
      </div>
      <div class="lineup-card">
        <div class="lineup-title">CSIA ë¼ì¸ì—…</div>
        <div id="lineupEditorCSIA"></div>
      </div>
    </div>

    <!-- ë¼ì¸ì—… ì§„í–‰ íˆ´ë°” -->
    <div class="lineup-footer" style="display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:6px;">
      <button id="startLineupBtn" type="button">ë¼ì¸ì—… ì‹œì‘</button>
      <button id="prevBatterBtn" type="button">â—€ ì´ì „ íƒ€ì ë³´ê¸°</button>
      <button id="nextBatterBtn" type="button">ë‹¤ìŒ íƒ€ì â–¶</button>
      <span class="muted" id="currentBatterInfo">í˜„ì¬ íƒ€ì: -</span>
    </div>

    <!-- íˆ¬ìˆ˜/íƒ€ì ì…ë ¥ ê·¸ë¦¬ë“œ -->
    <div class="duel-grid">
      <!-- íˆ¬ìˆ˜ -->
      <div style="flex:1; min-width: 320px;">
        <h3>íˆ¬ìˆ˜ ì„ íƒ ë° ê¸°ë¡</h3>
        <input type="text" id="pitcherSearch" placeholder="íˆ¬ìˆ˜ ì´ë¦„ ê²€ìƒ‰" autocomplete="off" />
        <div id="pitcherSearchResults"></div>
        <div id="pitcherEditSection" style="display:none;">
          <div id="pitcherNameDisplay"></div>

          <!-- ì»¤ìŠ¤í…€ ìŠ¤í”¼ë„ˆê°€ ë‹¬ë¦° ìˆ«ì ì…ë ¥ -->
          <div class="num-row">
            <label>íˆ¬êµ¬ìˆ˜(+)</label>
            <div class="spin-wrap">
              <button class="spin-btn" data-spin="dec" data-target="pitcherPitchCountInput">â–¼</button>
              <input id="pitcherPitchCountInput" class="spin-input" type="number" min="0" step="1" value="0" />
              <button class="spin-btn" data-spin="inc" data-target="pitcherPitchCountInput">â–²</button>
            </div>
          </div>
          <div class="num-row">
            <label>ì´ë‹(+)</label>
            <div class="spin-wrap">
              <button class="spin-btn" data-spin="dec" data-target="pitcherInningsInput">â–¼</button>
              <input id="pitcherInningsInput" class="spin-input" type="number" min="0" step="0.1" value="0" />
              <button class="spin-btn" data-spin="inc" data-target="pitcherInningsInput">â–²</button>
            </div>
          </div>

          <!-- ë‹¨ì¼ ì„ íƒ ê·¸ë£¹ 1: ì‚¼ì§„/ë³¼ë„·/í”¼ì•ˆíƒ€/í”¼í™ˆëŸ°/ì‚¬êµ¬ -->
          <div class="group-title">ì´ë²ˆ ê²°ê³¼(íˆ¬ìˆ˜) â€“ íƒ1</div>
          <div id="pitcherGroup1" class="chip-group" role="group" aria-label="Pitcher Result Group 1"></div>

          <!-- ë‹¨ì¼ ì„ íƒ ê·¸ë£¹ 2: ìŠ¹ë¦¬/íŒ¨ë°°/í™€ë“œ/ì„¸ì´ë¸Œ -->
          <div class="group-title">ìŠ¹íŒ¨/ì„¸ì´ë¸Œ â€“ íƒ1</div>
          <div id="pitcherGroup2" class="chip-group" role="group" aria-label="Pitcher Result Group 2"></div>
        </div>
      </div>

      <!-- íƒ€ì -->
      <div style="flex:1; min-width: 320px;">
        <h3>íƒ€ì ì„ íƒ ë° ê¸°ë¡</h3>
        <input type="text" id="hitterSearch" placeholder="(ë‹¨ë… ì„ íƒìš©) íƒ€ì ì´ë¦„ ê²€ìƒ‰" autocomplete="off" />
        <div id="hitterSearchResults"></div>
        <div id="hitterEditSection" style="display:none;">
          <div id="hitterNameDisplay"></div>

          <!-- ë‹¨ì¼ ì„ íƒ ê·¸ë£¹(íƒ€ì) -->
          <div class="group-title">ì´ë²ˆ ê²°ê³¼(íƒ€ì) â€“ íƒ1</div>
          <div id="hitterGroup" class="chip-group" role="group" aria-label="Hitter Result Group"></div>

          <!-- ìˆ«ì ì…ë ¥: íƒ€ì  -->
          <div class="num-row">
            <label>íƒ€ì (+)</label>
            <div class="spin-wrap">
              <button class="spin-btn" data-spin="dec" data-target="hitterRBIInput">â–¼</button>
              <input id="hitterRBIInput" class="spin-input" type="number" min="0" step="1" value="0" />
              <button class="spin-btn" data-spin="inc" data-target="hitterRBIInput">â–²</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- í•˜ë‹¨ íˆ´ë°” -->
    <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;">
      <button id="saveDuelBtn">ëŒ€ê²° ê¸°ë¡ ì €ì¥(ì¦ë¶„ ë°˜ì˜ & ìë™ ë‹¤ìŒ íƒ€ì)</button>
      <button id="historyBackBtn" style="background:#6c63ff;">â—€ íˆìŠ¤í† ë¦¬ ì´ì „ ë³´ê¸°</button>
      <button id="historyForwardBtn" style="background:#6c63ff;">íˆìŠ¤í† ë¦¬ ë‹¤ìŒ ë³´ê¸° â–¶</button>
      <button id="endHalfBtn" style="margin-left:auto; background:#e67e22;">ì´ë‹ ì¢…ë£Œ(ê³µìˆ˜ ì „í™˜)</button>
      <button id="prevInningBtn" style="background:#34a853;">â—€ ì´ì „ ì´ë‹ ë³´ê¸°</button>
      <button id="nextInningBtn" style="background:#34a853;">ë‹¤ìŒ ì´ë‹ ë³´ê¸° â–¶</button>
    </div>
  </section>

  <!-- ë“±ë¡ ì„ ìˆ˜ ëª©ë¡ -->
  <section class="section">
    <h2 style="margin-top:0;">ë“±ë¡ ì„ ìˆ˜ ëª©ë¡</h2>
    <div class="player-list" id="playerList"></div>
  </section>

  <!-- MVP / JSON -->
  <div class="mvp-section" style="background:var(--card); border:1px solid var(--border);">
    <h2 style="color:var(--brand);">MVP ì„ ì •</h2>
    <select id="mvpSelect">
      <option value="" disabled selected>ì„ ìˆ˜ ì„ íƒ</option>
    </select>
    <button id="selectMvpBtn">MVP ì„ ì •</button>
    <p id="mvpMessage" class="mvp-message"></p>

    <button id="exportJsonBtn" style="margin-top: 12px; background: #34a853;">JSON íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°</button>
    <div style="margin-top:12px;">
      <input type="file" id="importJsonFile" accept="application/json" />
      <button id="importJsonBtn" style="margin-top: 8px; background: #fbbc05;">JSON ë¶ˆëŸ¬ì˜¤ê¸°</button>
    </div>
  </div>

<script>
/* ==== í…Œë§ˆ í† ê¸€ ==== */
(function(){
  const root=document.documentElement, btn=document.getElementById('themeToggle');
  const saved = localStorage.getItem('theme');
  if(saved){ root.setAttribute('data-theme', saved); btn.textContent = saved==='dark'?'â˜€ï¸ ë¼ì´íŠ¸ ëª¨ë“œ':'ğŸŒ™ ë‹¤í¬ ëª¨ë“œ'; }
  btn.addEventListener('click',()=>{
    const isDark = root.getAttribute('data-theme')==='dark';
    const next = isDark ? '' : 'dark';
    if(next) root.setAttribute('data-theme', next); else root.removeAttribute('data-theme');
    localStorage.setItem('theme', next||'');
    btn.textContent = next==='dark'?'â˜€ï¸ ë¼ì´íŠ¸ ëª¨ë“œ':'ğŸŒ™ ë‹¤í¬ ëª¨ë“œ';
  });
})();

/* ==== Storage Keys ==== */
const STORAGE_KEY = 'playersData';
const LINEUP_KEY_BY_TEAM = (team)=>`lineup_${team}`; // {batters:[], pitcher:""}  (êµ¬ë²„ì „ ë°°ì—´ë„ ìë™ í˜¸í™˜)
const LINEUP_IDX_KEY_BY_TEAM = (team)=>`lineup_idx_${team}`;
const HISTORY_KEY = 'duelHistory_v2';
const GAME_STATE_KEY = 'gameState_v2';
const FIRST_TEAM_KEY = 'firstTeam_sel';

/* ==== Data ==== */
let players = [];
let offenseTeam = 'Leaders';
let defenseTeam = 'CSIA';
let inning = 1;
let half = 'ì´ˆ'; // 'ì´ˆ' | 'ë§'
let duelHistory = [];
let historyPtr = -1;
let viewInning = 1;
let viewHalf = 'ì´ˆ';

const hitterStatsHeaders  = ['1ë£¨íƒ€','2ë£¨íƒ€','3ë£¨íƒ€','í™ˆëŸ°','ì‚¼ì§„','ë³¼ë„·','í¬ìƒí”Œë¼ì´','ë‚´ì•¼ë•…ë³¼','í”Œë¼ì´ì•„ì›ƒ','íƒ€ì '];
const pitcherStatsHeaders = ['íˆ¬êµ¬ìˆ˜','ì‚¼ì§„','ë³¼ë„·','í”¼ì•ˆíƒ€','í”¼í™ˆëŸ°','ìì±…ì ','ì´ë‹','ìŠ¹ë¦¬','íŒ¨ë°°','í™€ë“œ','ì„¸ì´ë¸Œ','ì‚¬êµ¬'];

/* ==== Storage helpers ==== */
const savePlayers = (p)=>localStorage.setItem(STORAGE_KEY, JSON.stringify(p));
const loadPlayers = ()=>JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

// ë¼ì¸ì—… ì €ì¥/ë¡œë“œ í¬ë§·: {batters:[], pitcher:""}  (êµ¬ë²„ì „ ë°°ì—´ë„ ì½ì–´ì¤Œ)
function getLineup(team){
  const raw = localStorage.getItem(LINEUP_KEY_BY_TEAM(team));
  if(!raw) return {batters: [], pitcher: ''};
  try{
    const parsed = JSON.parse(raw);
    if(Array.isArray(parsed)) return {batters: parsed, pitcher: ''}; // êµ¬ë²„ì „ í˜¸í™˜
    if(parsed && typeof parsed==='object')
      return {batters: parsed.batters || [], pitcher: parsed.pitcher || ''};
  }catch(e){}
  return {batters: [], pitcher: ''};
}
function saveLineup(team, obj){ localStorage.setItem(LINEUP_KEY_BY_TEAM(team), JSON.stringify(obj)); }

const saveLineupIdx = (team, idx)=>localStorage.setItem(LINEUP_IDX_KEY_BY_TEAM(team), String(idx||0));
const loadLineupIdx = (team)=>parseInt(localStorage.getItem(LINEUP_IDX_KEY_BY_TEAM(team))||'0',10);

const saveHistory = ()=>localStorage.setItem(HISTORY_KEY, JSON.stringify(duelHistory));
const loadHistory = ()=>JSON.parse(localStorage.getItem(HISTORY_KEY)||'[]');

const saveGameState = ()=>{ localStorage.setItem(GAME_STATE_KEY, JSON.stringify({offenseTeam, defenseTeam, inning, half})); };
const loadGameState = ()=>{
  const s = JSON.parse(localStorage.getItem(GAME_STATE_KEY)||'{}');
  offenseTeam = s.offenseTeam || 'Leaders';
  defenseTeam = s.defenseTeam || 'CSIA';
  inning = s.inning || 1;
  half = s.half || 'ì´ˆ';
};

/* ==== Init ==== */
function init(){
  players = loadPlayers();
  duelHistory = loadHistory();
  loadGameState();

  // ì„ ê³µ ê¸°ë³¸ ë³µì›
  const savedFirst = localStorage.getItem(FIRST_TEAM_KEY);
  if(savedFirst){
    document.getElementById('firstTeamSel').value = savedFirst;
    setFirstTeam(savedFirst, false);
  }else{
    setFirstTeam(offenseTeam, false);
  }

  renderPlayerList();
  updateMvpSelect();
  setupSearchAndEdit();
  buildBothLineups();
  updateInningBadge();
  updateHistoryBadge();
  updateCurrentBatterInfo();
  ensureAutoPitcher();
  syncSearchInputs();
}

/* ==== helpers ==== */
const currentBatters = ()=>getLineup(offenseTeam).batters;
const currentIdx = ()=>loadLineupIdx(offenseTeam);
const setCurrentIdx = (v)=>saveLineupIdx(offenseTeam, v);
function getCurrentBatter(){
  const lu = currentBatters();
  if(lu.length===0) return null;
  const idx = currentIdx()%lu.length;
  return lu[idx]||null;
}

/* ==== UI Utils ==== */
function updateInningBadge(){
  document.getElementById('inningBadge').textContent = `${inning}íšŒ ${half} Â· ê³µê²©: ${offenseTeam}`;
}
function updateHistoryBadge(){
  const total = duelHistory.length;
  const ptrText = (historyPtr===-1) ? 'ìµœì‹ ' : `${historyPtr+1}/${total}`;
  document.getElementById('historyBadge').textContent = `íˆìŠ¤í† ë¦¬ ${total}ê±´ Â· í¬ì¸í„° ${ptrText}`;
}
function updateCurrentBatterInfo(){
  const b = getCurrentBatter();
  document.getElementById('currentBatterInfo').textContent =
    b ? `í˜„ì¬ íƒ€ì: ${b}` : 'í˜„ì¬ íƒ€ì: (ë¼ì¸ì—… ë¹„ì–´ ìˆìŒ)';
}

/* ==== ì„ ê³µ/ì´ˆê¸°í™” ==== */
function setFirstTeam(team, persist=true){
  offenseTeam = team;
  defenseTeam = (team==='Leaders')?'CSIA':'Leaders';
  if(persist) localStorage.setItem(FIRST_TEAM_KEY, team);
  saveGameState();
  updateInningBadge();
  updateCurrentBatterInfo();
  ensureAutoPitcher();
  syncSearchInputs();
}
document.getElementById('applyFirstTeamBtn').addEventListener('click', ()=>{
  const team = document.getElementById('firstTeamSel').value;
  setFirstTeam(team, true);
  alert(`ì„ ê³µ íŒ€ì„ ${team}ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.`);
});
document.getElementById('resetInningBtn').addEventListener('click', ()=>{
  inning = 1; half='ì´ˆ';
  const first = document.getElementById('firstTeamSel').value;
  setFirstTeam(first, true);
  saveGameState();
  updateInningBadge();
  updateCurrentBatterInfo();
  alert('ì´ë‹ì´ 1íšŒ ì´ˆë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
});

/* === íˆ¬/íƒ€ ê²€ìƒ‰ì¹¸ ìë™ ë™ê¸°í™” & ìˆ˜ë¹„íŒ€ íˆ¬ìˆ˜ ìë™ ë°˜ì˜ === */
function applyPitcherFromDefenseLineup(){
  const { pitcher } = getLineup(defenseTeam);
  if(!pitcher) return false;
  const p = players.find(x=>x.type==='íˆ¬ìˆ˜' && x.name===pitcher && x.team===defenseTeam);
  if(!p) return false;
  const pitcherEdit=document.getElementById('pitcherEditSection');
  pitcherEdit.style.display='block';
  renderPitcherEditor(p);
  document.getElementById('pitcherNameDisplay').textContent = `${p.name} (${p.team})`;
  document.getElementById('pitcherSearch').value = p.name;
  return true;
}
function ensureAutoPitcher(){
  if(applyPitcherFromDefenseLineup()) return;
  const cand = players.find(p=>p.type==='íˆ¬ìˆ˜' && p.team===defenseTeam);
  if(!cand) return;
  const pitcherEdit=document.getElementById('pitcherEditSection');
  pitcherEdit.style.display='block';
  renderPitcherEditor(cand);
  document.getElementById('pitcherNameDisplay').textContent = `${cand.name} (${cand.team})`;
  document.getElementById('pitcherSearch').value = cand.name;
}
function syncSearchInputs(){
  const curBatter = getCurrentBatter();
  if(curBatter) document.getElementById('hitterSearch').value = curBatter;
  const pName = (document.getElementById('pitcherNameDisplay').textContent||'').split(' (')[0].trim();
  if(pName) document.getElementById('pitcherSearch').value = pName;
}

/* ==== ì„ ìˆ˜ ì¶”ê°€ & ëª©ë¡ ==== */
const playerListDiv = document.getElementById('playerList');

document.getElementById('addPlayerForm').addEventListener('submit', e=>{
  e.preventDefault();
  const name = document.getElementById('playerName').value.trim();
  const type = document.getElementById('playerType').value;
  const team = document.getElementById('playerTeam').value;
  if(!name || !team) return alert('ëª¨ë“  ê°’ì„ ì…ë ¥í•˜ì„¸ìš”.');
  if(players.some(p=>p.name===name && p.type===type)) return alert('ì´ë¯¸ ë“±ë¡ëœ ì„ ìˆ˜ì…ë‹ˆë‹¤.');

  const stats = (type==='íƒ€ì')
    ? hitterStatsHeaders.reduce((a,c)=>(a[c]=0,a),{})
    : pitcherStatsHeaders.reduce((a,c)=>(a[c]=0,a),{});
  players.push({name, type, team, stats, mvpCount:0});
  savePlayers(players);
  renderPlayerList(); updateMvpSelect(); buildBothLineups();
  e.target.reset();
  ensureAutoPitcher(); syncSearchInputs();
});

playerListDiv.addEventListener('click', e=>{
  const idx = parseInt(e.target.dataset.idx);
  if (e.target.classList.contains('delete-btn')) {
    if (confirm(`${players[idx].name} ì„ ìˆ˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
      ['Leaders','CSIA'].forEach(t=>{
        const obj = getLineup(t);
        obj.batters = obj.batters.filter(n=>n!==players[idx].name);
        if(obj.pitcher === players[idx].name) obj.pitcher = '';
        saveLineup(t, obj);
      });
      players.splice(idx,1);
      savePlayers(players);
      renderPlayerList(); buildBothLineups(); updateMvpSelect();
      ensureAutoPitcher(); syncSearchInputs();
    }
  } else if (e.target.classList.contains('stat-btn')) {
    const stat = e.target.dataset.stat;
    const delta = parseInt(e.target.dataset.delta);
    if (stat === 'mvpCount') {
      const newVal = (players[idx].mvpCount || 0) + delta;
      if (newVal < 0) return;
      players[idx].mvpCount = newVal;
    } else {
      const newVal = (players[idx].stats[stat] || 0) + delta;
      if (newVal < 0) return;
      players[idx].stats[stat] = newVal;
    }
    savePlayers(players);
    renderPlayerList();
  }
});

function renderPlayerList(){
  playerListDiv.innerHTML = '';
  if(players.length===0){
    playerListDiv.textContent = 'ë“±ë¡ëœ ì„ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.';
    return;
  }
  players.forEach((player, idx)=>{
    const container = document.createElement('div');
    const keys = Object.keys(player.stats);
    let html = `<h3>${player.name} (${player.team} / ${player.type}) <button class="delete-btn" data-idx="${idx}">ì‚­ì œ</button></h3>`;
    html += '<table><thead><tr>'+keys.map(k=>`<th>${k}</th>`).join('')+'<th>MVP íšŸìˆ˜</th></tr></thead><tbody><tr>';
    html += keys.map(k=>`
      <td class="buttons-cell">
        <button class="stat-btn" data-idx="${idx}" data-stat="${k}" data-delta="1">â–²</button>
        <button class="stat-btn" data-idx="${idx}" data-stat="${k}" data-delta="-1">â–¼</button>
      </td>`).join('');
    html += `
      <td class="buttons-cell">
        <button class="stat-btn" data-idx="${idx}" data-stat="mvpCount" data-delta="1">â–²</button>
        <button class="stat-btn" data-idx="${idx}" data-stat="mvpCount" data-delta="-1">â–¼</button>
      </td>
    </tr><tr>`;
    html += keys.map(k=>`<td>${player.stats[k]}</td>`).join('');
    html += `<td>${player.mvpCount||0}</td></tr></tbody></table>`;
    container.innerHTML = html;
    playerListDiv.appendChild(container);
  });
}

/* ==== MVP ==== */
function updateMvpSelect(){
  const sel = document.getElementById('mvpSelect');
  sel.innerHTML = '<option value="" disabled selected>ì„ ìˆ˜ ì„ íƒ</option>';
  players.forEach((p,i)=>{
    const opt = document.createElement('option');
    opt.value=i; opt.textContent=`${p.name} (${p.team} / ${p.type})`;
    sel.appendChild(opt);
  });
}
document.getElementById('selectMvpBtn').addEventListener('click', ()=>{
  const sel=document.getElementById('mvpSelect');
  const idx=sel.value;
  if(idx===''||idx==null) return alert('ì„ ìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
  players[idx].mvpCount=(players[idx].mvpCount||0)+1;
  savePlayers(players);
  document.getElementById('mvpMessage').textContent=`${players[idx].name} ì„ ìˆ˜ë¥¼ MVPë¡œ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤. (ëˆ„ì  ${players[idx].mvpCount})`;
  renderPlayerList();
});
document.getElementById('exportJsonBtn').addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(players,null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='players.json';
  document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
});
document.getElementById('importJsonBtn').addEventListener('click', async ()=>{
  const file = document.getElementById('importJsonFile').files?.[0];
  if(!file) return alert('JSON íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.');
  try{
    const data = JSON.parse(await file.text());
    if(!Array.isArray(data)) throw new Error('í˜•ì‹ ì˜¤ë¥˜');
    players=data; savePlayers(players);
    renderPlayerList(); updateMvpSelect(); buildBothLineups();
    ensureAutoPitcher(); syncSearchInputs();
    alert('ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ');
  }catch(e){ alert('ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: '+e.message); }
});

/* ==== ë‹¨ì¼ ì„ íƒ(ì¹©) ìœ í‹¸ ==== */
function renderChipGroup(rootEl, options){
  rootEl.innerHTML = '';
  options.forEach(opt=>{
    const chip = document.createElement('div');
    chip.className = 'chip';
    chip.textContent = opt;
    chip.dataset.value = opt;
    chip.addEventListener('click', ()=>{
      if(chip.classList.contains('selected')){
        chip.classList.remove('selected'); // í† ê¸€ í•´ì œ
        return;
      }
      [...rootEl.querySelectorAll('.chip')].forEach(c=>c.classList.remove('selected'));
      chip.classList.add('selected');
    });
    rootEl.appendChild(chip);
  });
}
function getSelectedValue(rootEl){
  const sel = rootEl.querySelector('.chip.selected');
  return sel ? sel.dataset.value : '';
}
function clearChipSelection(rootEl){
  rootEl && [...rootEl.querySelectorAll('.chip')].forEach(c=>c.classList.remove('selected'));
}

/* ==== ì»¤ìŠ¤í…€ ìŠ¤í”¼ë„ˆ ==== */
document.addEventListener('click',(e)=>{
  const btn = e.target.closest('.spin-btn');
  if(!btn) return;
  const id = btn.dataset.target;
  const input = document.getElementById(id);
  const step = parseFloat(input.step||'1');
  const cur = parseFloat(input.value||'0')||0;
  input.value = (btn.dataset.spin==='inc') ? (cur+step).toFixed(step<1?1:0)
                                           : Math.max(0,cur-step).toFixed(step<1?1:0);
});

/* ==== íˆ¬ìˆ˜/íƒ€ì ì—ë””í„° ==== */
function findPlayer(name,type){ return players.find(p=>p.name===name && p.type===type); }
function renderPitcherEditor(pitcher){
  document.getElementById('pitcherNameDisplay').textContent = `${pitcher.name} (${pitcher.team})`;
  renderChipGroup(document.getElementById('pitcherGroup1'), ['ì‚¼ì§„','ë³¼ë„·','í”¼ì•ˆíƒ€','í”¼í™ˆëŸ°','ì‚¬êµ¬']);
  renderChipGroup(document.getElementById('pitcherGroup2'), ['ìŠ¹ë¦¬','íŒ¨ë°°','í™€ë“œ','ì„¸ì´ë¸Œ']);
  document.getElementById('pitcherPitchCountInput').value = 0;
  document.getElementById('pitcherInningsInput').value = 0;
}
function renderHitterEditor(hitter){
  document.getElementById('hitterNameDisplay').textContent = `${hitter.name} (${hitter.team})`;
  renderChipGroup(document.getElementById('hitterGroup'),
    ['1ë£¨íƒ€','2ë£¨íƒ€','3ë£¨íƒ€','í™ˆëŸ°','ì‚¼ì§„','ë³¼ë„·','í¬ìƒí”Œë¼ì´','ë‚´ì•¼ë•…ë³¼','í”Œë¼ì´ì•„ì›ƒ']);
  document.getElementById('hitterRBIInput').value = 0;
}

/* ==== ê²€ìƒ‰/ì„ íƒ ==== */
function setupSearchAndEdit(){
  const pitcherInput=document.getElementById('pitcherSearch');
  const hitterInput =document.getElementById('hitterSearch');
  const pitcherResults=document.getElementById('pitcherSearchResults');
  const hitterResults =document.getElementById('hitterSearchResults');
  const pitcherEdit=document.getElementById('pitcherEditSection');
  const hitterEdit =document.getElementById('hitterEditSection');

  function renderList(inputEl, resultsEl, type){
    const kw=inputEl.value.trim().toLowerCase();
    const list=players.filter(p=>p.type===type && p.name.toLowerCase().includes(kw));
    resultsEl.innerHTML=list.map(p=>`<div data-name="${p.name}">${p.name} (${p.team})</div>`).join('');
    resultsEl.style.display=list.length?'block':'none';
  }
  pitcherInput.addEventListener('input',()=>renderList(pitcherInput,pitcherResults,'íˆ¬ìˆ˜'));
  hitterInput .addEventListener('input',()=>renderList(hitterInput ,hitterResults ,'íƒ€ì'));

  pitcherResults.addEventListener('click',(e)=>{
    if(e.target.matches('div[data-name]')){
      const name=e.target.getAttribute('data-name');
      const p=findPlayer(name,'íˆ¬ìˆ˜'); if(!p) return;
      pitcherEdit.style.display='block';
      renderPitcherEditor(p);
      pitcherResults.style.display='none';
      if(p.team===defenseTeam){ const obj=getLineup(p.team); obj.pitcher=p.name; saveLineup(p.team,obj); }
      syncSearchInputs();
    }
  });
  hitterResults.addEventListener('click',(e)=>{
    if(e.target.matches('div[data-name]')){
      const name=e.target.getAttribute('data-name');
      const h=findPlayer(name,'íƒ€ì'); if(!h) return;
      hitterEdit.style.display='block';
      renderHitterEditor(h);
      hitterResults.style.display='none';
      const lu=currentBatters(); const i=lu.indexOf(name);
      if(i>=0){ setCurrentIdx(i); updateCurrentBatterInfo(); }
      syncSearchInputs();
    }
  });
}

/* ==== ë¼ì¸ì—…(ì–‘ìª½) ==== */
function buildBothLineups(){
  buildLineupEditor('Leaders', 'lineupEditorLeaders');
  buildLineupEditor('CSIA', 'lineupEditorCSIA');
}
function buildLineupEditor(team, mountId){
  const root=document.getElementById(mountId);
  const obj = getLineup(team);
  const batters = players.filter(p=>p.type==='íƒ€ì' && p.team===team).map(p=>p.name);
  const pitchers = players.filter(p=>p.type==='íˆ¬ìˆ˜' && p.team===team).map(p=>p.name);

  const dlB = `dl_b_${team}`;
  const dlP = `dl_p_${team}`;
  const dls = `
    <datalist id="${dlB}">${batters.map(n=>`<option value="${n}">`).join('')}</datalist>
    <datalist id="${dlP}">${pitchers.map(n=>`<option value="${n}">`).join('')}</datalist>
  `;

  let html = `
    ${dls}
    <table class="lineup-table">
      <thead><tr><th style="width:60px;">íƒ€ìˆœ</th><th>ì„±ëª…</th></tr></thead>
      <tbody>
        ${Array.from({length:9}).map((_,i)=>`
          <tr>
            <td>${i+1}</td>
            <td><input list="${dlB}" data-team="${team}" data-idx="${i}" class="lu-input" placeholder="ì´ë¦„ ì…ë ¥" value="${obj.batters[i]||''}"></td>
          </tr>
        `).join('')}
        <tr>
          <th>P</th>
          <td><input list="${dlP}" data-team="${team}" class="lu-pitcher" placeholder="íˆ¬ìˆ˜ ì´ë¦„" value="${obj.pitcher||''}"></td>
        </tr>
      </tbody>
    </table>
  `;
  root.innerHTML = html;

  root.querySelectorAll('.lu-input').forEach(inp=>{
    inp.addEventListener('change',()=>{
      const t=inp.dataset.team;
      const o=getLineup(t);
      const idx=parseInt(inp.dataset.idx,10);
      o.batters[idx]=inp.value.trim();
      if(!o.batters[idx]) o.batters.splice(idx,1);
      saveLineup(t, o);
      if(t===offenseTeam) updateCurrentBatterInfo();
      syncSearchInputs();
    });
  });
  root.querySelector('.lu-pitcher').addEventListener('change', (e)=>{
    const t=e.target.dataset.team;
    const o=getLineup(t);
    o.pitcher = e.target.value.trim();
    saveLineup(t, o);
    if(t===defenseTeam){ applyPitcherFromDefenseLineup(); syncSearchInputs(); }
  });
}

/* ==== ë¼ì¸ì—… ì§„í–‰ ì»¨íŠ¸ë¡¤ ==== */
document.getElementById('startLineupBtn').addEventListener('click', ()=>{
  const lu=currentBatters();
  if(lu.length===0) return alert('í˜„ì¬ ê³µê²© íŒ€ì˜ ë¼ì¸ì—…ì„ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.');
  saveLineupIdx(offenseTeam, 0);
  updateCurrentBatterInfo();

  const hitter = findPlayer(lu[0],'íƒ€ì');
  if(hitter){
    const ec=document.getElementById('hitterEditSection');
    ec.style.display='block';
    renderHitterEditor(hitter);
  }
  ensureAutoPitcher();
  syncSearchInputs();
});
document.getElementById('nextBatterBtn').addEventListener('click', ()=>{
  const lu=currentBatters();
  if(lu.length===0) return alert('ë¼ì¸ì—…ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.');
  const idx=(currentIdx()+1)%lu.length;
  setCurrentIdx(idx);
  updateCurrentBatterInfo();
  const hitter=findPlayer(lu[idx],'íƒ€ì');
  if(hitter){
    const ec=document.getElementById('hitterEditSection');
    ec.style.display='block';
    renderHitterEditor(hitter);
  }
  ensureAutoPitcher();
  syncSearchInputs();
});
document.getElementById('prevBatterBtn').addEventListener('click', ()=>{
  const list = duelHistory.filter(r=>true);
  if(list.length===0) return alert('ì´ì „ íƒ€ì ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.');
  if(historyPtr===-1) historyPtr = list.length;
  historyPtr = Math.max(0, historyPtr-1);
  loadFromHistory(list[historyPtr]);
  updateHistoryBadge();
  syncSearchInputs();
});

/* ==== íˆìŠ¤í† ë¦¬ ë¡œë“œ ==== */
function loadFromHistory(rec){
  const p=findPlayer(rec.pitcherName,'íˆ¬ìˆ˜');
  if(p){
    const ec=document.getElementById('pitcherEditSection');
    ec.style.display='block';
    renderPitcherEditor(p);
    document.getElementById('pitcherNameDisplay').textContent = `${p.name} (${p.team})`;
    document.getElementById('pitcherSearch').value=p.name;
  }
  const h=findPlayer(rec.hitterName,'íƒ€ì');
  if(h){
    const ec=document.getElementById('hitterEditSection');
    ec.style.display='block';
    renderHitterEditor(h);
    document.getElementById('hitterNameDisplay').textContent = `${h.name} (${h.team})`;
    document.getElementById('hitterSearch').value=h.name;
    if(rec.offenseTeam===offenseTeam){
      const lu=currentBatters();
      const li=lu.indexOf(h.name);
      if(li>=0){ setCurrentIdx(li); updateCurrentBatterInfo(); }
    }
  }
}
document.getElementById('historyBackBtn').addEventListener('click', ()=>{
  if(duelHistory.length===0) return alert('íˆìŠ¤í† ë¦¬ ì—†ìŒ');
  if(historyPtr===-1) historyPtr = duelHistory.length-1;
  else historyPtr = Math.max(0, historyPtr-1);
  loadFromHistory(duelHistory[historyPtr]);
  updateHistoryBadge(); syncSearchInputs();
});
document.getElementById('historyForwardBtn').addEventListener('click', ()=>{
  if(duelHistory.length===0) return alert('íˆìŠ¤í† ë¦¬ ì—†ìŒ');
  if(historyPtr===-1) return;
  historyPtr++;
  if(historyPtr>=duelHistory.length){ historyPtr=-1; updateHistoryBadge(); syncSearchInputs(); return; }
  loadFromHistory(duelHistory[historyPtr]);
  updateHistoryBadge(); syncSearchInputs();
});

/* ==== ëŒ€ê²° ì €ì¥ (ì¦ë¶„ ë°˜ì˜) ==== */
document.getElementById('saveDuelBtn').addEventListener('click', ()=>{
  const defLu = getLineup(defenseTeam);
  let pitcherName = defLu.pitcher || (document.getElementById('pitcherNameDisplay').textContent||'').split(' (')[0].trim();

  let hitterName = (document.getElementById('hitterNameDisplay').textContent||'').split(' (')[0].trim();
  const lu=currentBatters();
  if(lu.length>0){
    const idx=currentIdx()%lu.length;
    hitterName = lu[idx] || hitterName;
  }
  if(!pitcherName) return alert('íˆ¬ìˆ˜ë¥¼ ì„ íƒí•˜ê±°ë‚˜ ë¼ì¸ì—…ì— íˆ¬ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
  if(!hitterName) return alert('íƒ€ìë¥¼ ì„ íƒí•˜ê±°ë‚˜ ë¼ì¸ì—…ì„ ì‹œì‘í•˜ì„¸ìš”.');

  const pitcher = findPlayer(pitcherName,'íˆ¬ìˆ˜');
  const hitter  = findPlayer(hitterName ,'íƒ€ì');
  if(!pitcher || !hitter) return alert('ì„ ìˆ˜ ë°ì´í„° ì˜¤ë¥˜ì…ë‹ˆë‹¤.');

  // íˆ¬ìˆ˜ ì¦ë¶„
  const pitchCountDelta = Math.max(0, parseFloat(document.getElementById('pitcherPitchCountInput').value)||0);
  const inningsDelta    = Math.max(0, parseFloat(document.getElementById('pitcherInningsInput').value)||0);
  const g1 = getSelectedValue(document.getElementById('pitcherGroup1')); // 'ì‚¼ì§„','ë³¼ë„·','í”¼ì•ˆíƒ€','í”¼í™ˆëŸ°','ì‚¬êµ¬'
  const g2 = getSelectedValue(document.getElementById('pitcherGroup2')); // 'ìŠ¹ë¦¬','íŒ¨ë°°','í™€ë“œ','ì„¸ì´ë¸Œ'

  pitcher.stats['íˆ¬êµ¬ìˆ˜'] = (pitcher.stats['íˆ¬êµ¬ìˆ˜']||0) + pitchCountDelta;
  pitcher.stats['ì´ë‹']   = (pitcher.stats['ì´ë‹']  ||0) + inningsDelta;
  if(g1){ pitcher.stats[g1] = (pitcher.stats[g1]||0) + 1; }
  if(g2){ pitcher.stats[g2] = (pitcher.stats[g2]||0) + 1; }

  // íƒ€ì ì¦ë¶„
  const hitterEvt = getSelectedValue(document.getElementById('hitterGroup'));
  const rbiDelta  = Math.max(0, parseInt(document.getElementById('hitterRBIInput').value)||0);
  if(hitterEvt){ hitter.stats[hitterEvt] = (hitter.stats[hitterEvt]||0) + 1; }
  if(rbiDelta){ hitter.stats['íƒ€ì '] = (hitter.stats['íƒ€ì ']||0) + rbiDelta; }

  savePlayers(players);

  duelHistory.push({pitcherName,hitterName,offenseTeam,defenseTeam,inning,half,ts:Date.now()});
  saveHistory();
  historyPtr=-1; updateHistoryBadge();

  // ë‹¤ìŒ íƒ€ì
  if(lu.length>0){
    setCurrentIdx((currentIdx()+1)%lu.length);
    updateCurrentBatterInfo();
    const nextH=findPlayer(getCurrentBatter(),'íƒ€ì');
    if(nextH){
      const ec=document.getElementById('hitterEditSection');
      ec.style.display='block';
      renderHitterEditor(nextH);
    }
  }
  ensureAutoPitcher(); syncSearchInputs();

  // ì…ë ¥ ì´ˆê¸°í™”
  document.getElementById('pitcherPitchCountInput').value = 0;
  document.getElementById('pitcherInningsInput').value = 0;
  clearChipSelection(document.getElementById('pitcherGroup1'));
  clearChipSelection(document.getElementById('pitcherGroup2'));
  clearChipSelection(document.getElementById('hitterGroup'));
  document.getElementById('hitterRBIInput').value = 0;

  alert('ëŒ€ê²° ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (ì¦ë¶„ ë°˜ì˜ ì™„ë£Œ)');
  renderPlayerList();
});

/* ==== ì´ë‹ ì¢…ë£Œ & ì´ì „/ë‹¤ìŒ ì´ë‹ ë³´ê¸° ==== */
document.getElementById('endHalfBtn').addEventListener('click', ()=>{
  [offenseTeam, defenseTeam] = [defenseTeam, offenseTeam];
  if(half==='ì´ˆ'){ half='ë§'; } else { half='ì´ˆ'; inning += 1; }
  saveGameState();
  updateInningBadge();
  updateCurrentBatterInfo();
  ensureAutoPitcher();
  syncSearchInputs();
  alert(`ì´ë‹ ì „í™˜: ${inning}íšŒ ${half} Â· ê³µê²© ${offenseTeam}`);
});
document.getElementById('prevInningBtn').addEventListener('click', ()=>{
  if(viewHalf==='ë§'){ viewHalf='ì´ˆ'; viewInning = Math.max(1, viewInning-1); }
  else { if(viewInning>1){ viewHalf='ë§'; viewInning-=1; } }
  jumpToLastPAOf(viewInning, viewHalf);
});
document.getElementById('nextInningBtn').addEventListener('click', ()=>{
  if(viewHalf==='ì´ˆ'){ viewHalf='ë§'; }
  else { viewHalf='ì´ˆ'; viewInning += 1; }
  jumpToLastPAOf(viewInning, viewHalf);
});
function jumpToLastPAOf(inn, hf){
  const list = duelHistory.filter(r=>r.inning===inn && r.half===hf);
  if(list.length===0){ alert(`${inn}íšŒ ${hf} ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.`); updateHistoryBadge(); return; }
  const rec = list[list.length-1];
  loadFromHistory(rec);
  syncSearchInputs();
  alert(`${inn}íšŒ ${hf} ë§ˆì§€ë§‰ íƒ€ì„ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
}

/* ==== ì‹œì‘ ==== */
init();
</script>
</body>
</html>

